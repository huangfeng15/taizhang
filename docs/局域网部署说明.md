# 局域网部署说明

## 概述
本文档说明如何将Django项目部署到本地局域网，使局域网内其他设备可以访问。

## 配置变更

### 1. 已修改的配置
- **文件**: `config/settings.py`
- **修改内容**: `ALLOWED_HOSTS` 已配置为允许所有主机访问
- **用途**: 允许局域网内的设备访问服务器

### 2. 启动脚本
已创建 `run_lan_server.bat` 批处理脚本，用于快速启动局域网服务器。

## 使用方法

### 方式一: 使用启动脚本（推荐）
1. 双击运行 `run_lan_server.bat`
2. 脚本会自动：
   - 激活虚拟环境
   - 显示本机IP地址
   - 在 0.0.0.0:3500 启动服务器
3. 局域网内其他设备可通过 `http://[服务器IP]:3500` 访问

### 方式二: 手动命令行启动
```bash
# 1. 激活虚拟环境
.venv\Scripts\activate

# 2. 启动服务器
python manage.py runserver 0.0.0.0:3500
```

## 访问方式

### 本机访问
- `http://127.0.0.1:3500`
- `http://localhost:3500`

### 局域网访问
1. 查看服务器IP地址：
   - Windows: 运行 `ipconfig` 查看IPv4地址
   - 示例IP: `192.168.1.100`

2. 其他设备通过以下地址访问：
   - `http://192.168.1.100:3500`

## 防火墙配置

如果局域网内其他设备无法访问，需要配置防火墙：

### Windows防火墙设置
1. 打开"控制面板" → "Windows Defender 防火墙"
2. 点击"高级设置"
3. 选择"入站规则" → "新建规则"
4. 选择"端口" → 下一步
5. 选择"TCP"，输入特定端口 `3500`
6. 选择"允许连接"
7. 勾选所有配置文件（域、专用、公用）
8. 命名规则为"Django局域网服务器"
9. 完成

### 快速命令（管理员权限）
```cmd
netsh advfirewall firewall add rule name="Django Port 3500" dir=in action=allow protocol=TCP localport=3500
```

## 安全注意事项

⚠️ **重要警告**
- 当前配置使用 `DEBUG=True` 和 `ALLOWED_HOSTS=['*']`
- 这种配置**仅适用于内网开发环境**
- **不要在公网或生产环境使用此配置**

### 生产环境部署建议
如需正式部署，应：
1. 设置 `DEBUG=False`
2. 配置具体的 `ALLOWED_HOSTS`
3. 使用生产级服务器（如Gunicorn + Nginx）
4. 配置HTTPS证书
5. 设置强密码和访问控制

## 故障排查

### 问题1: 局域网其他设备无法访问
**解决方案**:
1. 确认防火墙已允许3500端口
2. 确认服务器使用 `0.0.0.0:3500` 启动（不是 `127.0.0.1:3500`）
3. 检查网络连接，确保在同一局域网
4. 尝试ping服务器IP，确认网络可达

### 问题2: 显示"DisallowedHost"错误
**解决方案**:
检查 `config/settings.py` 中的 `ALLOWED_HOSTS` 配置是否包含 `'*'` 或具体的IP地址

### 问题3: 数据库被锁定
**解决方案**:
```bash
# 关闭所有Django进程
# 删除数据库锁文件（如果存在）
# 重新启动服务器
```

## 常用管理命令

```bash
# 创建超级用户
python manage.py createsuperuser

# 数据迁移
python manage.py migrate

# 收集静态文件
python manage.py collectstatic

# 运行测试
python manage.py test
```

## 性能优化建议

### 局域网部署优化
1. 确保数据库文件在本地磁盘（非网络驱动器）
2. 调整Django连接数配置
3. 使用缓存机制（Redis/Memcached）
4. 定期清理日志文件

### 多用户并发
如需支持多用户同时访问：
1. 考虑使用PostgreSQL替代SQLite
2. 配置连接池
3. 增加服务器进程数

## 相关文档
- [开发实践指南](./开发实践指南.md)
- [系统架构分析文档](./系统架构分析文档.md)
- [性能优化说明](./性能优化说明.md)

## 技术支持
如遇问题，请查看：
1. Django日志文件（`logs/`目录）
2. 控制台输出信息
3. 浏览器开发者工具（F12）网络选项卡