
# 供应商管理模块技术文档

**文档版本**: v1.1
**创建日期**: 2025-01-07
**最后更新**: 2025-01-07
**项目名称**: 项目采购与成本管理系统 - 供应商管理模块
**技术栈**: Django 4.2 + PostgreSQL + Bootstrap 5

---

## 目录

1. [架构设计](#1-架构设计)
2. [数据模型设计](#2-数据模型设计)
3. [业务逻辑层设计](#3-业务逻辑层设计)
4. [视图层设计](#4-视图层设计)
5. [URL路由设计](#5-url路由设计)
6. [前端设计](#6-前端设计)
7. [数据导入设计](#7-数据导入设计)
8. [Admin后台配置](#8-admin后台配置)
9. [API接口设计](#9-api接口设计)
10. [性能优化](#10-性能优化)
11. [部署策略](#11-部署策略)

---

## 1. 架构设计

### 1.1 模块结构

```
supplier_eval/
├── __init__.py
├── models.py              # 数据模型
├── admin.py               # Admin后台配置
├── views.py               # 视图函数
├── forms.py               # 表单类
├── urls.py                # URL路由
├── services.py            # 业务逻辑服务
├── validators.py          # 数据校验
├── migrations/            # 数据库迁移
├── management/
│   └── commands/
│       └── import_supplier_eval.py  # 导入命令
└── templates/
    └── supplier/
        ├── evaluation_list.html
        ├── contract_list.html
        ├── interview_list.html
        ├── interview_detail.html
        └── interview_form.html
```

### 1.2 技术架构

```
┌─────────────────────────────────────────┐
│         前端展示层 (Templates)           │
│    Bootstrap 5 + JavaScript             │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│         视图层 (Views)                   │
│    Django CBV/FBV                       │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│      业务逻辑层 (Services)               │
│    SupplierAnalysisService              │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│         数据模型层 (Models)              │
│    SupplierEvaluation                   │
│    SupplierInterview                    │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│         数据库层 (PostgreSQL)            │
└─────────────────────────────────────────┘
```

### 1.3 设计原则

- **DRY (Don't Repeat Yourself)**: 复用现有Contract和Payment模型
- **SOLID原则**: 
  - S: 单一职责 - 每个类/函数职责明确
  - O: 开闭原则 - 通过服务层扩展功能
  - L: 里氏替换 - 继承BaseModel
  - I: 接口隔离 - 最小化服务接口
  - D: 依赖倒置 - 依赖抽象的BaseModel
- **KISS (Keep It Simple)**: 避免过度设计

---

## 2. 数据模型设计

### 2.1 ER图

```
┌─────────────────┐
│    Contract     │
│  (现有模型)     │
└────────┬────────┘
         │ 1
         │
         │ N
┌────────▼─────────────────┐      ┌──────────────────┐
│  SupplierEvaluation      │      │ SupplierInterview│
│  ────────────────────    │      │  ──────────────  │
│  + contract (FK)         │      │  + supplier_name │
│  + supplier_name         │      │  + contract (FK) │
│  + comprehensive_score   │      │  + interview_type│
│  + last_evaluation_score │      │  + interview_date│
│  + score_2019-2025       │      │  + reason        │
│  + irregular_eval_1/2    │      │  + content       │
│  + interview_records     │      │  + status        │
└──────────────────────────┘      └──────────────────┘
```

### 2.2 SupplierEvaluation模型（扩展现有模型 - 对应CSV字段）

**现有模型字段**（保留）:
- `evaluation_code` (主键)
- `contract` (外键)
- `supplier_name`
- `evaluation_period`
- `evaluator`
- `score`
- `evaluation_type`

**新增字段设计（对应CSV模板的13列）**:

```python
class SupplierEvaluation(BaseModel):
    """供应商履约评价模型 - 扩展版本（简化字段设计）"""
    
    # ===== 现有字段（保留）=====
    evaluation_code = models.CharField('评价编号', max_length=50, primary_key=True)
    contract = models.ForeignKey('contract.Contract', on_delete=models.PROTECT, related_name='evaluations')
    supplier_name = models.CharField('供应商名称', max_length=200, db_index=True)
    evaluation_period = models.CharField('评价日期区间', max_length=100, blank=True)
    evaluator = models.CharField('评价人员', max_length=50, blank=True)
    score = models.DecimalField('评分', max_digits=5, decimal_places=2, null=True, blank=True)
    evaluation_type = models.CharField('评价类型', max_length=20, blank=True)
    
    # ===== 新增字段（对应CSV列）=====
    # CSV列：履约综合评价得分（可导入或自动计算）
    comprehensive_score = models.DecimalField(
        '履约综合评价得分',
        max_digits=5,
        decimal_places=2,
        null=True,
        blank=True,
        help_text='可从CSV导入，或根据末次评价和过程评价自动计算'
    )
    
    # CSV列：末次评价得分（权重60%）
    last_evaluation_score = models.DecimalField(
        '末次评价得分',
        max_digits=5,
        decimal_places=2,
        null=True,
        blank=True,
        help_text='权重60%，用于计算综合评分'
    )
    
    # CSV列：2019-2025年度评价得分（支持延展2026、2027...）
    score_2019 = models.DecimalField('2019年度评价得分', max_digits=5, decimal_places=2, null=True, blank=True)
    score_2020 = models.DecimalField('2020年度评价得分', max_digits=5, decimal_places=2, null=True, blank=True)
    score_2021 = models.DecimalField('2021年度评价得分', max_digits=5, decimal_places=2, null=True, blank=True)
    score_2022 = models.DecimalField('2022年度评价得分', max_digits=5, decimal_places=2, null=True, blank=True)
    score_2023 = models.DecimalField('2023年度评价得分', max_digits=5, decimal_places=2, null=True, blank=True)
    score_2024 = models.DecimalField('2024年度评价得分', max_digits=5, decimal_places=2, null=True, blank=True)
    score_2025 = models.DecimalField('2025年度评价得分', max_digits=5, decimal_places=2, null=True, blank=True)
    # 扩展字段（未来可增加）
    # score_2026 = models.DecimalField('2026年度评价得分', max_digits=5, decimal_places=2, null=True, blank=True)
    # score_2027 = models.DecimalField('2027年度评价得分', max_digits=5, decimal_places=2, null=True, blank=True)
    
    # CSV列：不定期评价得分（支持延展第三次、第四次...）
    irregular_evaluation_1 = models.DecimalField('第一次不定期评价得分', max_digits=5, decimal_places=2, null=True, blank=True)
    irregular_evaluation_2 = models.DecimalField('第二次不定期评价得分', max_digits=5, decimal_places=2, null=True, blank=True)
    # 扩展字段（未来可增加）
    # irregular_evaluation_3 = models.DecimalField('第三次不定期评价得分', max_digits=5, decimal_places=2, null=True, blank=True)
    
    # CSV列：备注
    remarks = models.TextField('备注', blank=True)
    
    class Meta:
        verbose_name = '供应商履约评价'
        verbose_name_plural = '供应商履约评价'
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['contract']),
            models.Index(fields=['supplier_name']),
            models.Index(fields=['comprehensive_score']),
        ]
    
    class Meta:
        verbose_name = '供应商履约评价'
        verbose_name_plural = '供应商履约评价'
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['evaluation_code']),
            models.Index(fields=['contract']),
            models.Index(fields=['supplier_name']),
            models.Index(fields=['comprehensive_score']),
            models.Index(fields=['last_evaluation_score']),
        ]
    
    def save(self, *args, **kwargs):
        """保存时自动计算综合评分（如果CSV未提供）"""
        # 自动获取供应商名称
        if self.contract and not self.supplier_name:
            self.supplier_name = self.contract.party_b
        
        # 如果CSV没有提供综合评分，则自动计算
        if not self.comprehensive_score and self.last_evaluation_score:
            self.comprehensive_score = self.calculate_comprehensive_score()
        
        super().save(*args, **kwargs)
    
    def calculate_comprehensive_score(self):
        """
        计算综合评分
        公式：末次评价 × 60% + 过程评价平均 × 40%
        过程评价包括：所有年度评价 + 所有不定期评价
        """
        if not self.last_evaluation_score:
            return None
        
        # 收集过程评价得分
        process_scores = []
        
        # 年度评价得分（2019-2025，未来可扩展）
        annual_fields = [
            self.score_2019, self.score_2020, self.score_2021,
            self.score_2022, self.score_2023, self.score_2024, self.score_2025
        ]
        process_scores.extend([s for s in annual_fields if s is not None])
        
        # 不定期评价得分（支持扩展）
        irregular_fields = [
            self.irregular_evaluation_1,
            self.irregular_evaluation_2
        ]
        process_scores.extend([s for s in irregular_fields if s is not None])
        
        # 如果没有过程评价，综合得分 = 末次评价
        if not process_scores:
            return self.last_evaluation_score
        
        # 计算过程评价平均分
        process_avg = sum(process_scores) / len(process_scores)
        
        # 综合得分 = 末次评价 × 0.6 + 过程评价平均 × 0.4
        from decimal import Decimal
        comprehensive = (
            Decimal(str(self.last_evaluation_score)) * Decimal('0.6') +
            Decimal(str(process_avg)) * Decimal('0.4')
        )
        
        return round(comprehensive, 2)
```

**设计优势**：
- **简化设计**：直接使用DecimalField，与CSV模板一一对应
- **易于扩展**：需要新年度时，添加新字段（如score_2026）并更新CSV模板即可
- **导入友好**：字段名与CSV列名直接映射，无需JSON解析
- **向后兼容**：保留现有evaluation_code等字段
- **灵活计算**：支持CSV直接导入comprehensive_score，或自动计算

### 2.3 SupplierInterview模型

```python
class SupplierInterview(BaseModel):
    """供应商约谈记录模型"""
    
    # 主键
    id = models.AutoField(primary_key=True)
    
    # 基本信息
    supplier_name = models.CharField(max_length=200, db_index=True)
    
    # 外键关联（可选）
    contract = models.ForeignKey(
        'contract.Contract',
        on_delete=models.SET_NULL,
        null=True, blank=True,
        related_name='interviews'
    )
    
    # 约谈类型
    INTERVIEW_TYPE_CHOICES = [
        ('违约约谈', '违约约谈'),
        ('履约沟通', '履约沟通'),
        ('商务洽谈', '商务洽谈'),
        ('投标前沟通', '投标前沟通'),
        ('其他', '其他'),
    ]
    interview_type = models.CharField(
        max_length=20,
        choices=INTERVIEW_TYPE_CHOICES,
        default='履约沟通'
    )
    
    # 约谈信息
    interview_date = models.DateField(db_index=True)
    interviewer = models.CharField(max_length=100)
    supplier_representative = models.CharField(max_length=100, blank=True)
    
    # 详细内容
    reason = models.TextField()
    content = models.TextField()
    rectification_requirements = models.TextField(blank=True)
    result = models.TextField(blank=True)
    
    # 状态管理
    STATUS_CHOICES = [
        ('待整改', '待整改'),
        ('整改中', '整改中'),
        ('已完成', '已完成'),
        ('仅记录', '仅记录'),
    ]
    status = models.CharField(
        max_length=20,
        choices=STATUS_CHOICES,
        default='仅记录'
    )
    
    # 供应商类型
    has_contract = models.BooleanField(default=True)
    
    # 附件
    attachments = models.TextField(blank=True)
    
    class Meta:
        verbose_name = '供应商约谈记录'
        verbose_name_plural = '供应商约谈记录'
        ordering = ['-interview_date', '-created_at']
        indexes = [
            models.Index(fields=['supplier_name']),
            models.Index(fields=['interview_date']),
            models.Index(fields=['interview_type']),
            models.Index(fields=['status']),
            models.Index(fields=['has_contract']),
        ]
```

### 2.4 数据库索引策略

| 模型 | 索引字段 | 类型 | 原因 |
|------|---------|------|------|
| SupplierEvaluation | evaluation_code | B-Tree | 现有主键索引 |
| SupplierEvaluation | supplier_name | B-Tree | 现有索引，频繁按供应商查询 |
| SupplierEvaluation | contract | Foreign Key | 现有索引，关联查询优化 |
| SupplierEvaluation | comprehensive_score | B-Tree | 新增，支持排序和筛选 |
| SupplierEvaluation | last_evaluation_score | B-Tree | 新增，支持筛选 |
| SupplierInterview | supplier_name | B-Tree | 频繁按供应商查询 |
| SupplierInterview | interview_date | B-Tree | 时间范围查询 |
| SupplierInterview | interview_type | B-Tree | 类型筛选 |
| SupplierInterview | status | B-Tree | 状态筛选 |

**迁移策略**：
1. 在现有SupplierEvaluation模型上添加新字段
2. 所有新字段设置为nullable（null=True, blank=True）
3. 创建迁移时设置default=None，不影响现有数据
4. 添加comprehensive_score和last_evaluation_score的B-Tree索引
5. 未来扩展年度字段时，按相同模式添加（如score_2026）

---

## 3. 业务逻辑层设计

### 3.1 SupplierAnalysisService

```python
class SupplierAnalysisService:
    """供应商分析服务"""
    
    @staticmethod
    def get_supplier_summary(supplier_name=None):
        """
        获取供应商汇总统计
        
        返回格式:
        [
            {
                'party_b': '供应商名称',
                'total_contracts': 10,
                'ongoing_contracts': 3,
                'total_amount': Decimal('5000000.00'),
                'total_paid': Decimal('3000000.00'),
            },
            ...
        ]
        """
        from django.db.models import Count, Sum, Q
        from contract.models import Contract
        
        contracts = Contract.objects.filter(
            file_positioning='主合同'
        )
        
        if supplier_name:
            contracts = contracts.filter(party_b__icontains=supplier_name)
        
        return contracts.values('party_b').annotate(
            total_contracts=Count('contract_code'),
            ongoing_contracts=Count(
                'contract_code',
                filter=Q(settlement__isnull=True)
            ),
            # 合同总金额 = 主合同金额 + 补充协议金额
            # 注意：这里需要在视图层计算，因为Django ORM不支持对每个主合同单独求和补充协议
        )
        
        # 在视图层补充total_amount计算（包含补充协议）
        # 示例：
        # for item in result:
        #     supplier = item['party_b']
        #     contracts = Contract.objects.filter(party_b=supplier, file_positioning='主合同')
        #     item['total_amount'] = sum(c.get_contract_with_supplements_amount() for c in contracts)
    
    @staticmethod
    def get_supplier_contracts(supplier_name):
        """
        获取供应商承接的所有合同详情
        
        返回格式:
        [
            {
                'contract': Contract对象,
                'payment_ratio': 75.5,
                'is_ongoing': True,
                'total_paid': Decimal('1500000.00'),
                'payment_count': 5,
            },
            ...
        ]
        """
        from contract.models import Contract
        
        contracts = Contract.objects.filter(
            party_b__icontains=supplier_name,
            file_positioning='主合同'
        ).select_related('settlement').prefetch_related('payments')
        
        result = []
        for contract in contracts:
            result.append({
                'contract': contract,
                'payment_ratio': contract.get_payment_ratio(),
                'is_ongoing': not hasattr(contract, 'settlement') or contract.settlement is None,
                'total_paid': contract.get_total_paid_amount(),
                'payment_count': contract.get_payment_count(),
            })
        
        return result
    
    @staticmethod
    def get_evaluation_statistics():
        """
        获取履约评价统计数据
        
        返回格式:
        {
            'total': 100,
            'excellent': 20,  # ≥90分
            'good': 50,       # ≥80分
            'qualified': 25,  # ≥70分
            'unqualified': 5, # <70分
            'avg_score': 82.5,
        }
        """
        from django.db.models import Count, Avg, Q
        from supplier_eval.models import SupplierEvaluation
        
        evaluations = SupplierEvaluation.objects.filter(
            comprehensive_score__isnull=False
        )
        
        return {
            'total': evaluations.count(),
            'excellent': evaluations.filter(comprehensive_score__gte=90).count(),
            'good': evaluations.filter(
                comprehensive_score__gte=80,
                comprehensive_score__lt=90
            ).count(),
            'qualified': evaluations.filter(
                comprehensive_score__gte=70,
                comprehensive_score__lt=80
            ).count(),
            'unqualified': evaluations.filter(comprehensive_score__lt=70).count(),
            'avg_score': evaluations.aggregate(Avg('comprehensive_score'))['comprehensive_score__avg'],
        }
```

---

## 4. 视图层设计

### 4.1 前端模态框集成

**使用现有的EditModal系统**：
- 复用 `project/static/js/edit-modal.js`
- 复用 `project/templates/components/edit_form.html`
- 使用Bootstrap模态框样式
- 集成SmartSelector智能选择器

**示例代码**：
```html
<!-- 编辑按钮 -->
<button data-edit-url="{% url 'supplier_interview_edit' interview.id %}"
        data-title="编辑约谈记录"
        class="btn btn-sm btn-secondary">
    <i class="fas fa-edit"></i> 编辑
</button>
```

### 4.2 视图函数列表

| 视图函数 | URL名称 | 方法 | 功能 |
|---------|---------|------|------|
| supplier_evaluation_list | supplier_evaluation_list | GET | 履约评价列表 |
| supplier_contract_list | supplier_contract_list | GET | 承接项目列表 |
| supplier_interview_list | supplier_interview_list | GET | 约谈记录列表 |
| supplier_interview_detail | supplier_interview_detail | GET | 约谈记录详情 |
| supplier_interview_create | supplier_interview_create | GET/POST | 创建约谈记录（AJAX） |
| supplier_interview_edit | supplier_interview_edit | GET/POST | 编辑约谈记录（AJAX）|

---

## 11. 部署策略

### 11.1 零停机部署方案

本模块采用**零停机、渐进式上线**的部署策略，确保生产环境不中断服务。

#### 11.1.1 核心原则

- **零停机**: 生产环境不中断服务
- **渐进式**: 分阶段发布，降低风险
- **可回滚**: 任何阶段都可快速回退
- **独立性**: 新模块不影响现有功能

#### 11.1.2 部署架构

```
生产环境 (线上用户访问)
    ├── 现有功能 (project, procurement, contract, payment, settlement)
    └── 新模块 (supplier_eval) - 独立部署
```

#### 11.1.3 时间规划

| 阶段 | 工作内容 | 预计时间 | 影响范围 |
|------|---------|---------|---------|
| 准备阶段 | 环境配置、代码合并 | 1小时 | 无 |
| 数据库迁移 | 执行migration | 5分钟 | 无影响 |
| 代码部署 | 更新代码、重启服务 | 10分钟 | 无影响 |
| 灰度测试 | 内部验证 | 2小时 | 无 |
| 全量发布 | 开放给全部用户 | 即时 | 无 |

### 11.2 环境隔离方案

#### 11.2.1 开发测试环境

**目的**: 完全独立的开发测试环境，不影响生产

```bash
# 1. 创建测试分支
cd f:/kaifa/taizhang
git checkout -b feature/supplier-eval-dev

# 2. 使用独立的数据库文件进行开发
# 修改 config/settings.py (仅在开发分支)
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db_dev.sqlite3',  # 开发专用数据库
    }
}

# 3. 开发环境启动
python manage.py runserver 0.0.0.0:8001  # 使用不同端口
```

#### 11.2.2 生产环境隔离

- 生产环境继续使用 `db.sqlite3`
- 开发环境使用 `db_dev.sqlite3`
- 两者完全隔离，互不影响

### 11.3 数据库迁移策略

#### 11.3.1 向后兼容的迁移设计

**关键原则**: 新增字段必须可选 (nullable)

```python
# supplier_eval/migrations/0001_initial.py

class Migration(migrations.Migration):
    dependencies = [
        ('contract', '0010_last_migration'),  # 依赖现有模块
    ]

    operations = [
        migrations.CreateModel(
            name='SupplierEvaluation',
            fields=[
                ('evaluation_code', models.CharField(max_length=50, primary_key=True)),
                ('contract', models.ForeignKey(...)),
                ('supplier_name', models.CharField(max_length=200, db_index=True)),
                
                # 关键：所有新字段都设置为 nullable
                ('comprehensive_score', models.DecimalField(
                    max_digits=5, decimal_places=2, 
                    null=True, blank=True  # 可选字段
                )),
                # ... 其他字段同样设置为 nullable
            ],
        ),
        
        # 创建索引 - 不影响现有查询
        migrations.AddIndex(
            model_name='supplierevaluation',
            index=models.Index(fields=['supplier_name'], name='supplier_name_idx'),
        ),
    ]
```

**优势**:
- ✅ 迁移执行快速 (仅创建新表和索引)
- ✅ 不修改现有表结构
- ✅ 不会锁定现有表
- ✅ 现有功能完全不受影响

#### 11.3.2 迁移执行计划

```bash
# 步骤1: 在开发环境测试迁移
cd f:/kaifa/taizhang
git checkout feature/supplier-eval-dev
python manage.py makemigrations supplier_eval
python manage.py migrate supplier_eval

# 步骤2: 验证迁移正确性
python manage.py sqlmigrate supplier_eval 0001  # 查看SQL

# 步骤3: 生产环境执行迁移（零停机）
git checkout main
git merge feature/supplier-eval-dev
python manage.py migrate supplier_eval  # 执行时间 < 5秒
```

### 11.4 代码部署流程

#### 11.4.1 部署前准备清单

- [ ] 代码已在开发环境充分测试
- [ ] 数据库迁移已验证
- [ ] 备份当前生产数据库
- [ ] 准备回滚脚本
- [ ] 通知相关人员部署时间窗口

#### 11.4.2 零停机部署步骤

```bash
# ===== 步骤1: 备份生产数据库 =====
cd f:/kaifa/taizhang/backups
python ../manage.py dumpdata > backup_$(date +%Y%m%d_%H%M%S).json
cp ../db.sqlite3 db_backup_$(date +%Y%m%d_%H%M%S).sqlite3

# ===== 步骤2: 代码合并 =====
cd f:/kaifa/taizhang
git checkout main
git pull origin main
git merge feature/supplier-eval-dev

# ===== 步骤3: 执行数据库迁移 =====
python manage.py migrate supplier_eval
# 预计执行时间: 3-5秒

# ===== 步骤4: 收集静态文件 =====
python manage.py collectstatic --noinput

# ===== 步骤5: 重启Django服务 =====
taskkill /F /IM python.exe /FI "WINDOWTITLE eq Django*"
start_server.bat

# ===== 步骤6: 验证服务启动 =====
curl http://10.168.3.240:3500/
```

**重启时间**: 5-10秒  
**用户影响**: 极小（仅短暂的连接等待）

### 11.5 功能灰度发布

#### 11.5.1 基于权限的灰度策略

**第一阶段：内部测试（1-2天）**

```python
# supplier_eval/views.py
from django.contrib.auth.decorators import login_required, user_passes_test

def is_beta_tester(user):
    """仅允许管理员和测试组用户访问"""
    return user.is_superuser or user.groups.filter(name='供应商模块测试组').exists()

@login_required
@user_passes_test(is_beta_tester)
def supplier_evaluation_list(request):
    # 视图逻辑
    pass
```

**第二阶段：全量发布**

移除权限限制，开放给所有用户。

#### 11.5.2 基于配置的功能开关

```python
# config/settings.py
SUPPLIER_EVAL_ENABLED = os.environ.get('SUPPLIER_EVAL_ENABLED', 'false').lower() == 'true'

# supplier_eval/views.py
from django.conf import settings

def supplier_evaluation_list(request):
    if not settings.SUPPLIER_EVAL_ENABLED:
        return HttpResponseForbidden("此功能尚未启用")
    # 视图逻辑
```

### 11.6 回滚预案

#### 11.6.1 快速回滚步骤

**场景1: 代码回滚**

```bash
cd f:/kaifa/taizhang
git log --oneline
git revert <commit_hash>
python manage.py collectstatic --noinput
taskkill /F /IM python.exe /FI "WINDOWTITLE eq Django*"
start_server.bat
```

**场景2: 数据库迁移回退**

```bash
python manage.py migrate supplier_eval zero
```

**场景3: 恢复数据库备份**

```bash
cd f:/kaifa/taizhang
rm db.sqlite3
cp backups/db_backup_YYYYMMDD_HHMMSS.sqlite3 db.sqlite3
```

#### 11.6.2 回滚影响分析

| 回滚操作 | 现有功能影响 | 数据丢失风险 | 恢复时间 |
|---------|-------------|-------------|---------|
| 代码回滚 | 无 | 无 | 5分钟 |
| 迁移回退 | 无 | supplier_eval模块数据丢失 | 1分钟 |
| 数据库恢复 | 无 | 备份后的新增数据丢失 | 3分钟 |

### 11.7 监控与验证

#### 11.7.1 部署后验证清单

**立即验证（部署后5分钟内）**:

- [ ] 服务启动成功
- [ ] 现有功能正常（采购、合同、支付、结算）
- [ ] Admin后台可访问
- [ ] 数据库表已创建
- [ ] 静态文件正常加载

**功能验证（内部测试阶段）**:

- [ ] 供应商履约评价列表可访问
- [ ] CSV导入功能正常
- [ ] 承接项目查询正常
- [ ] 约谈记录CRUD功能正常
- [ ] 筛选和搜索功能正常

### 11.8 部署时间窗口建议

- **推荐时间**: 工作日下午5:00-6:00（使用低峰期）
- **备选时间**: 周末上午10:00-11:00
- **避免时间**: 月末、季度末、年末（业务高峰期）

### 11.9 部署优势总结

✅ **零停机**: 整个部署过程用户无感知  
✅ **低风险**: 新模块完全独立，不影响现有功能  
✅ **可回滚**: 任何阶段都可快速回退  
✅ **可控性**: 灰度发布，逐步验证  
✅ **可追溯**: 完整的备份和日志记录

---

**文档状态**: ✅ 已完成  
**包含部署方案**: ✅ 已整合零停机部署策略