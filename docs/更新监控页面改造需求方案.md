# 更新监控页面改造需求方案

## 文档信息

- **创建日期**: 2025-01-12
- **文档版本**: v1.0
- **作者**: Documentation Writer
- **关联文档**: 
  - [归档监控页面完整需求文档](./归档监控页面完整需求文档.md)
  - [归档监控页面改造-技术方案与实施计划](./归档监控页面改造-技术方案与实施计划.md)

---

## 一、需求背景

### 1.1 改造动机

**用户原始需求**：
> "当前归档监控页面的设计、内容都非常好，我希望更新监控页面也按照这个页面的方法来调整，因为它能够调取到我想要的数据，又不会显得页面冗杂。"

**核心诉求分析**：
1. **数据精准性**：归档监控能够精准调取用户需要的数据
2. **页面简洁性**：信息展示清晰，不冗杂
3. **设计一致性**：希望更新监控采用相同的设计方法
4. **新增功能**：需要查询本周、本月、本年度的更新数据

归档监控页面经过改造后，采用了双视图模式（项目视图/个人视图），设计清晰、数据完整、交互流畅。用户对这种设计方法非常认可，希望更新监控也能参照这个成功模式进行改造。

### 1.2 现有更新监控页面分析

当前更新监控页面具有以下特点：

**优点**：
- ✅ 热力图可视化直观，能快速识别准时/延迟状态
- ✅ 按项目分组展示，便于查看各项目的更新情况
- ✅ 支持按项目/按人员两种统计维度
- ✅ KPI卡片展示关键指标

**不足**：
- ❌ 缺少双视图切换（项目视图/个人视图）
- ❌ 无法查看单个项目或经办人的详细趋势
- ❌ 没有时间范围筛选（本周/本月/本年度更新查询功能）
- ❌ 热力图和统计表联动性不强

---

## 二、改造目标

### 2.1 核心目标

**参照归档监控页面的成功设计，实现更新监控的双视图模式，并新增时间范围查询功能。**

### 2.2 具体目标

1. **双视图模式**：实现项目视图和个人视图的切换
2. **详细数据展示**：点击项目/经办人后显示详细的更新情况和趋势
3. **时间范围查询**：支持查询本周/本月/本年度的更新数据
4. **数据联动**：热力图、统计表、详情区域数据联动展示
5. **保持现有优势**：保留热力图可视化的直观性

---

## 三、功能设计

### 3.1 双视图模式设计

#### 3.1.1 项目视图

**展示维度**：以项目为单位

**页面布局**：

```
┌────────────────────────────────────────────────────────┐
│ 页面标题: 更新监控                                    │
│ [项目视图] [个人视图]                    [全局筛选]  │
├────────────────────────────────────────────────────────┤
│ KPI卡片（4张）                                         │
│ ┌──────┬──────┬──────┬──────┐                        │
│ │项目数│准时率│事件数│延迟数│                        │
│ └──────┴──────┴──────┴──────┘                        │
├────────────────────────────────────────────────────────┤
│ 项目列表（带热力图）                                   │
│ ┌────────────────────────────────────────────────┐   │
│ │ 项目A [准时率: 85%]                            │   │
│ │ ┌─────────────────────────────────────────┐   │   │
│ │ │ 月度热力图（1-12月）                    │   │   │
│ │ │ 采购 [✓][✓][×][✓]...                   │   │   │
│ │ │ 合同 [✓][×][✓][✓]...                   │   │   │
│ │ │ 付款 [✓][✓][✓][✓]...                   │   │   │
│ │ │ 结算 [✓][✓][✓][✓]...                   │   │   │
│ │ └─────────────────────────────────────────┘   │   │
│ │ [查看详情]                                     │   │
│ └────────────────────────────────────────────────┘   │
├────────────────────────────────────────────────────────┤
│ 详细统计表（按项目）                                   │
│ ┌────────────────────────────────────────────────┐   │
│ │ 项目│采购│合同│付款│结算│总计│准时率│          │   │
│ │ A   │8/10│9/10│10/10│5/10│32/40│80%│          │   │
│ └────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────┘
```

**主要功能**：
1. 显示所有项目的更新准时率
2. 每个项目显示月度热力图（采购/合同/付款/结算4个模块）
3. 点击"查看详情"展开该项目的详细信息

#### 3.1.2 个人视图

**展示维度**：以经办人为单位

**页面布局**：

```
┌────────────────────────────────────────────────────────┐
│ 页面标题: 更新监控                                    │
│ [项目视图] [个人视图]                    [全局筛选]  │
├────────────────────────────────────────────────────────┤
│ KPI卡片（4张）                                         │
│ ┌──────┬──────┬──────┬──────┐                        │
│ │经办人│准时率│事件数│延迟数│                        │
│ └──────┴──────┴──────┴──────┘                        │
├────────────────────────────────────────────────────────┤
│ 经办人列表表格                                         │
│ ┌────────────────────────────────────────────────┐   │
│ │ 姓名│项目数│准时事件│延迟事件│准时率│操作│     │   │
│ │ 张三│3个  │25      │5       │83%   │详情│     │   │
│ │ 李四│2个  │18      │2       │90%   │详情│     │   │
│ └────────────────────────────────────────────────┘   │
├────────────────────────────────────────────────────────┤
│ 详细统计表（按人员）                                   │
│ ┌────────────────────────────────────────────────┐   │
│ │ 经办人│采购│合同│付款│结算│总计│准时率│       │   │
│ │ 张三  │8/10│9/10│10/10│5/10│32/40│80%│       │   │
│ └────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────┘
```

**主要功能**：
1. 显示所有经办人的更新准时率
2. 显示每个经办人负责的项目数
3. 点击"查看详情"展开该经办人的详细信息

### 3.2 详情展示设计

#### 3.2.1 项目详情（点击项目后弹出模态框）

**展示内容**：

```
┌────────────────────────────────────────────────────────┐
│ 项目详情: PRJ001 - XX项目名称            [关闭×]     │
├────────────────────────────────────────────────────────┤
│ 更新准时率统计                                         │
│ ┌──────┬──────┬──────┬──────┐                        │
│ │采购  │合同  │付款  │结算  │                        │
│ │85%   │90%   │100%  │75%   │                        │
│ └──────┴──────┴──────┴──────┘                        │
├────────────────────────────────────────────────────────┤
│ 月度更新趋势图                                         │
│ ┌────────────────────────────────────────────────┐   │
│ │     准时 vs 延迟（堆叠柱状图）                 │   │
│ │  10┤ ████████                                   │   │
│ │   8┤ ████████░░                                 │   │
│ │   6┤ ████████░░                                 │   │
│ │    └─1月─2月─3月─...                           │   │
│ │    ■准时 ░延迟                                 │   │
│ └────────────────────────────────────────────────┘   │
├────────────────────────────────────────────────────────┤
│ 延迟记录明细（可切换模块：采购/合同/付款/结算）      │
│ [采购] [合同] [付款] [结算]                           │
│ ┌────────────────────────────────────────────────┐   │
│ │ 编号│业务日期│录入日期│截止日期│延迟天数│经办人│  │
│ │ P001│2024-12-20│2025-01-15│2025-01-31│0│张三│ │   │
│ │ P002│2024-12-25│延迟未录│2025-01-31│15│李四│ │   │
│ └────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────┘
```

#### 3.2.2 经办人详情（点击经办人后弹出模态框）

**展示内容**：类似项目详情，但数据范围是该经办人的所有业务

---

### 3.3 时间范围查询功能设计

#### 3.3.1 功能需求

用户需要快速查询某个时间范围内的更新情况：
- **本周**更新了哪些数据？
- **本月**更新了哪些数据？
- **本年度**更新了哪些数据？

#### 3.3.2 数据量评估

**潜在风险分析**：
- 本周：约12条记录（可直接展示）✅
- 本月：约50条记录（需分页展示）⚠️
- 本年度：约600条记录（必须分页+筛选）❌

**结论**：需要独立页面支持复杂查询和分页功能。

#### 3.3.3 方案评估与推荐

**用户原始问题**：
> "更新监控还要有一个模块，就是可以查询本周、本月、本年度更新了哪些数据。但不知道会不会涉及数据量过大，你评估一下是在导航栏独立展示还是怎样展示更好。"

**数据量评估结论**：
经过评估，本年度查询可能产生600+条记录，直接在主页展示会导致页面过长、性能下降。因此**不建议在导航栏独立展示**，而是采用**双层设计方案**。

**推荐方案：双层设计（主页快捷入口 + 独立查询页面）**

**为什么不在导航栏独立展示？**
❌ 导航栏会变得过于复杂，影响整体结构
❌ 与更新监控功能关联紧密，分离会降低使用效率
❌ 独立菜单项无法直观展示数据量预览
✅ 推荐作为更新监控的子功能，通过快捷入口访问

**第一层：主页快捷入口（轻量查询）**

在更新监控主页面底部添加快捷查询模块：

```
┌────────────────────────────────────────────────────────┐
│ 快捷查询 - 最近更新记录                               │
│ ┌────────────────────────────────────────────────┐   │
│ │ 📋 本周新增: 12条  本月新增: 50条             │   │
│ │ [查看本周详情] [查看本月详情] [高级查询>>]    │   │
│ └────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────┘
```

**第二层：独立查询页面（深度查询）**

创建独立页面：`/monitoring/update-records/`

**页面设计**：

```
┌────────────────────────────────────────────────────────┐
│ 更新记录查询                          [返回更新监控]  │
├────────────────────────────────────────────────────────┤
│ 筛选条件                                               │
│ ┌────────────────────────────────────────────────┐   │
│ │ 时间范围: ●本周 ○本月 ○本年度 ○自定义        │   │
│ │ 自定义:   [2024-12-01] 至 [2024-12-31]        │   │
│ │ 业务模块: ☑采购 ☑合同 ☑付款 ☑结算             │   │
│ │ 经办人:   [全部 ▼]                             │   │
│ │ 项目:     [全部 ▼]                             │   │
│ │ [重置] [查询]                                  │   │
│ └────────────────────────────────────────────────┘   │
├────────────────────────────────────────────────────────┤
│ 统计摘要                                               │
│ ┌──────┬──────┬──────┬──────┬──────┐               │
│ │总记录│采购  │合同  │付款  │结算  │               │
│ │120   │25    │35    │45    │15    │               │
│ └──────┴──────┴──────┴──────┴──────┘               │
├────────────────────────────────────────────────────────┤
│ 更新记录列表                                           │
│ ┌────────────────────────────────────────────────┐   │
│ │录入日期│模块│编号  │名称│经办人│业务日期│项目││   │
│ │01-05   │采购│P001  │... │张三  │12-20   │A   ││   │
│ │01-05   │合同│C001  │... │李四  │12-22   │B   ││   │
│ │01-06   │付款│PAY01 │... │张三  │12-25   │A   ││   │
│ └────────────────────────────────────────────────┘   │
│ [« 上一页] 第1页/共3页 [下一页 »]                    │
├────────────────────────────────────────────────────────┤
│ 导出功能                                               │
│ [导出Excel] [导出CSV]                                 │
└────────────────────────────────────────────────────────┘
```

**功能特点**：
1. **灵活的时间筛选**：支持本周/本月/本年度快捷选项+自定义日期范围
2. **多维度筛选**：模块、经办人、项目三重筛选，可叠加关键字检索
3. **统计摘要**：显示查询结果的汇总统计
4. **分页展示**：每页50条，避免页面过长
5. **数据导出**：支持Excel和CSV格式导出

#### 3.3.4 时间范围口径、入口与权限

- **时间口径**：
  - *本周*：自然周（周一00:00至周日23:59），若当前为周一则向前回溯至上一周，以保证有数据可查。
  - *本月*：自然月，跨年由系统自动识别；若选择当月，则上限为当前日期。
  - *本年度*：自然年；如需财政年度，可在自定义模式下选择起止日期。
  - 自定义范围最大跨度90天，超过需改为导出任务。
- **入口与导航**：
  - 更新监控主页底部的“快捷查询”模块仅展示数据概览与快捷按钮。
  - “高级查询>>”跳转到 `/monitoring/update-records/`，保留面包屑“更新监控 / 更新记录查询”，并在页面提供“返回更新监控”按钮。
- **权限与审计**：
  - 快捷查询所有人可见；独立查询页面仅限具备 `view_update_records` 权限的角色访问。
  - 导出动作校验 `export_update_records` 权限，并写入导出审计日志（操作者、时间、参数、记录数）。
  - 若用户无权访问，将在主页快捷模块中隐藏按钮并提示联系管理员。

---

## 四、数据逻辑设计

### 4.1 更新准时率计算规则

**准时规则**：业务发生后**次月月底前**完成录入视为准时。

**计算公式**：
```
准时率 = 准时事件数 / 总事件数 × 100%

准时判断：
- 业务日期：2024年12月20日
- 截止日期：2025年1月31日
- 录入日期：2025年1月15日
- 结论：准时（录入日期 ≤ 截止日期）
```

**事件触发规则**：
- 采购：结果公示日期
- 合同：签订日期
- 付款：付款日期
- 结算：完成日期

### 4.2 双视图数据范围

#### 项目视图
- **全局筛选未指定项目**：显示所有项目列表
- **全局筛选指定项目**：只显示该项目的热力图和详情

#### 个人视图
- **全局筛选未指定项目**：显示所有经办人的数据
- **全局筛选指定项目**：只显示在该项目中有业务的经办人

### 4.3 时间范围查询数据范围

**本周**：
- 计算方式：当前日期所在周的周一至周日
- 例如：2025-01-06（周一）至 2025-01-12（周日）

**本月**：
- 计算方式：当前月份的第一天至最后一天
- 例如：2025-01-01 至 2025-01-31

**本年度**：
- 计算方式：当前年度的1月1日至12月31日
- 例如：2025-01-01 至 2025-12-31

**自定义**：
- 用户选择任意日期范围

**数据范围**：
- 查询条件：`created_at` 或 `updated_at` 字段在指定时间范围内
- 显示字段：录入日期、模块类型、业务编号、业务名称、经办人、业务日期、所属项目

---

## 五、技术实现方案

### 5.1 参照归档监控的成功实践

参照归档监控页面的技术实现，保持一致的开发模式：

1. **服务层扩展**：拆分概览/详情/记录查询服务，通过门面类暴露统一接口。
2. **URL参数管理**：view_mode、target_code、time_range、自定义日期等参数统一处理，保证口径一致。
3. **模态框详情展示**：与归档监控一致但增加热力图与趋势卡片的懒加载。
4. **Chart.js图表**：使用相同的图表库和配置风格，便于维护。
5. **缓存与分页策略**：服务层对概览、时间查询分别设置TTL，避免一次性拉取所有数据导致卡顿。

### 5.2 核心服务分层

| 服务 | 职责 | 关键方法 |
|------|------|----------|
| `UpdateOverviewProvider` | 生成项目/个人视图概览列表、KPI卡 | `get_projects_overview(filters, page)`、`get_persons_overview(filters, page)` |
| `UpdateDetailProvider` | 提供模态框所需热力图、趋势、延迟记录 | `get_project_detail(project_code, filters)`、`get_person_detail(person_code, filters)` |
| `UpdateRecordsService` | 承担时间范围查询、分页、导出 | `query(time_range, modules, person, project, page)`、`export(task)` |
| `UpdateTrendCalculator` | 计算周/月准时率趋势与热力图数据 | `build_heatmap(project_code, year)` |
| `UpdateStatisticsFacade` | Facade，聚合上述服务，供视图层调用 | `get_overview(...)`、`get_detail(...)`、`get_records(...)` |

**设计要点**：
- `UpdateRecordsService` 依赖统一的时间口径解析器（`TimeRangeResolver`），保证“本周/本月/本年度”含义一致，并支持90天范围限制。
- Facade 将缓存、权限校验、指标埋点统一处理，避免在视图中散落逻辑。
- 概览列表强制分页（项目每页20条、人员每页30条），时间查询每页50条；导出超过1000条时自动转后台任务并邮件通知。
- 缓存策略：概览5分钟TTL，详情1分钟TTL，时间查询不缓存但记录查询条件以便审计。

### 5.3 前端交互设计

**视图切换**：
```javascript
function switchView(mode) {
    const url = new URL(window.location.href);
    url.searchParams.set('view_mode', mode);
    url.searchParams.delete('time_range'); // 切换视图时清空时间范围
    url.searchParams.delete('target_code');
    window.location.href = url.toString();
}
```

**详情查看**：
```javascript
function viewDetail(targetCode) {
    const url = new URL(window.location.href);
    url.searchParams.set('target_code', targetCode);
    url.searchParams.delete('time_range');
    window.location.href = url.toString();
}
```

**模态框自动弹出**：
```javascript
{% if target_code %}
const modal = new bootstrap.Modal(document.getElementById('detailModal'));
modal.show();
{% endif %}
```

**时间查询入口**：
```python
def update_records(request):
    facade = UpdateStatisticsFacade()
    time_range = request.GET.get('time_range', 'week')
    resolved_range = TimeRangeResolver().resolve(time_range, request.GET)
    result = facade.get_records(user=request.user, filters={**resolved_range, **_resolve_filters(request)})
    return render(request, 'monitoring/update_records.html', {'result': result, 'resolved_range': resolved_range})
```

---

## 六、实施计划

### 6.1 迭代节奏与主要交付

更新监控涉及热力图、趋势、时间查询等多模块，整体排期调整为**11~13个工作日**，拆分如下：

- **迭代0（1天，准备）**
  - 梳理现有更新数据、确认“本周/本月/本年度”口径并与业务对齐。
  - 设计新的URL、路由、权限方案，准备缓存与分页策略。

- **迭代1（P0，5天） —— 双视图焕新**
  - Day1：实现 `UpdateOverviewProvider` 与 Facade，补齐分页、缓存、指标埋点。
  - Day2：重构 `update_monitor` 视图与模板，完成项目/个人视图及热力图骨架。
  - Day3：实现详情模态框基本信息与趋势卡片的懒加载。
  - Day4：补充KPI卡片、快捷查询入口、权限控制。
  - Day5：联调+灰度发布，仅开放双视图与基础详情。

- **迭代2（P0+，5天） —— 时间查询与导出**
  - Day6：实现 `TimeRangeResolver` 与 `UpdateRecordsService`，完成分页查询接口。
  - Day7：开发 `update_records` 页面、导出后台任务、审计日志。
  - Day8：打通快捷入口跳转、面包屑、角色控制。
  - Day9：性能/数据验证（周/月/年场景），补充自动化测试。
  - Day10：灰度开放时间查询与导出。

- **迭代3（预留2天，P1/P2）**
  - 优化热力图渲染、缓存命中策略、移动端适配等。

### 6.2 优先级矩阵

| 优先级 | 交付内容 | 说明 |
|--------|----------|------|
| **P0** | 双视图、分页概览、热力图懒加载、详情模态框（基础版） | 迭代1必须上线 |
| **P0+** | 时间范围查询、独立查询页、导出、快捷入口联动 | 迭代2上线 |
| **P1** | 趋势对比、快捷入口美化、缓存命中率监控 | 迭代3或后续版本 |
| **P2** | 移动端适配、智能预警、PDF导出 | 需求确认后排期 |

每次迭代结束前需完成：功能自测 → QA回归 → 业务确认 → 发布评审，并同步更新帮助文档。

---

## 七、验收标准

### 7.1 功能验收

- [ ] **F1**: 项目视图正确展示所有项目及热力图
- [ ] **F2**: 个人视图正确展示所有经办人统计
- [ ] **F3**: 视图切换功能正常，数据正确更新
- [ ] **F4**: 点击"查看详情"弹出模态框，显示准时率卡片、趋势图、延迟记录
- [ ] **F5**: 全局筛选正确影响两个视图的数据范围
- [ ] **F6**: 独立查询页面支持本周/本月/本年度/自定义查询
- [ ] **F7**: 查询结果支持分页和数据导出
- [ ] **F8**: 快捷查询入口显示本周/本月新增数量
- [ ] **F9**: 延迟记录按模块分组展示
- [ ] **F10**: 月度趋势图正确显示准时vs延迟数据

### 7.2 数据准确性验收

- [ ] **D1**: 更新准时率计算准确（次月月底前为准时）
- [ ] **D2**: KPI卡片数据与详细统计表数据一致
- [ ] **D3**: 热力图状态与实际业务状态一致
- [ ] **D4**: 时间范围查询结果准确
- [ ] **D5**: 导出数据与页面显示数据一致

### 7.3 性能验收

| 指标 | 目标值 | 测试方法 |
|------|--------|---------|
| 页面首次加载 | < 2秒 | Chrome DevTools |
| 视图切换响应 | < 1秒 | 实际测试 |
| 详情模态框打开 | < 500ms | 实际测试 |
| 查询页面响应 | < 2秒 | Chrome DevTools |
| 大数据量查询（600条） | < 3秒 | 实际测试 |

### 7.4 用户体验验收

- [ ] **U1**: 界面布局与归档监控保持一致风格
- [ ] **U2**: 交互流程流畅，无需多次点击
- [ ] **U3**: 热力图可视化直观易懂
- [ ] **U4**: 筛选条件清晰，操作简便
- [ ] **U5**: 错误提示友好
- [ ] **U6**: 响应式设计良好

---

## 八、风险评估与应对

### 8.1 技术风险

#### 风险1: 热力图与趋势渲染卡顿
**风险等级**: 中  
**影响**: 项目/经办人较多时，前端热力图和趋势图渲染可能阻塞主线程  
**应对措施**:
- 热力图采用CSS Grid + Canvas懒加载，详情模态框打开后再请求图表数据。
- 列表分页限制单页项目≤20、人员≤30，并对热力图区域使用IntersectionObserver按需渲染。
- 预置降级策略：当数据>200条时仅展示统计条，不渲染热力图。

#### 风险2: 时间查询对数据库造成压力
**风险等级**: 中  
**影响**: 本年度或跨模块查询可能产生600+记录，甚至触发导出大任务  
**应对措施**:
- 查询页强制服务器端分页（每页50条），禁止“显示全部”。
- 为 `business_date、module、responsible_person、project_id` 建复合索引，并加缓存层保护。
- 导出>1000条时转异步任务，使用队列和限流，避免阻塞线上数据库。

### 8.2 业务风险

#### 风险3: 时间口径理解不一致
**风险等级**: 中  
**影响**: “本周/本月/本年度”解释不一致导致数据争议  
**应对措施**:
- 在页面与帮助文档中明确口径（自然周/月/年）并展示计算方式。
- 允许业务自定义时间段，并在导出文件写明时间范围。
- 关键用户培训+FAQ，减少沟通成本。

#### 风险4: 权限与审计缺失
**风险等级**: 中  
**影响**: 未授权用户可访问敏感更新数据或频繁导出  
**应对措施**:
- 访问独立查询页、导出功能前均校验 `view_update_records` / `export_update_records`。
- 所有导出写审计日志，记录参数与记录数，便于追责。
- 对未授权用户隐藏快捷入口按钮，并提供指引流程申请权限。

---

## 九、与归档监控的差异点

### 9.1 保留的特色功能

**热力图可视化**：
- 更新监控保留热力图，这是其特色功能
- 按月度展示各模块的准时/延迟状态
- 归档监控没有类似的热力图

### 9.2 统计维度差异

**更新监控的模块**：
- 采购、合同、付款、结算（4个模块）
- 归档监控只有采购、合同（2个模块）

**判断标准差异**：
- 更新监控：次月月底前录入为准时
- 归档监控：规定天数内归档为准时（采购40天、合同30天）

### 9.3 新增功能

**时间范围查询**：
- 更新监控独有功能
- 支持查看本周/本月/本年度的更新记录
- 归档监控无此功能

---

## 十、总结与建议

### 10.1 核心要点

1. **设计一致性**：严格参照归档监控的成功设计，保持系统一致性
2. **保留特色**：保留热力图可视化，这是更新监控的特色
3. **功能增强**：新增时间范围查询，满足用户实际需求
4. **性能优先**：采用独立页面+分页方案，确保大数据量下性能

### 10.2 实施建议

**优先级推荐**：
1. **第一阶段**：实现双视图模式和详情展示（P0功能）
2. **第二阶段**：实现时间范围查询（P1功能）
3. **第三阶段**：优化用户体验和性能（P2功能）

**成功关键因素**：
- 复用归档监控的成功代码模式
- 保持服务层、视图层、模板层的清晰分离
- 充分的测试和用户反馈

### 10.3 后续优化方向


2. **多维度筛选**：模块、经办人、项目三重筛选
3. 

**短期优化（1-2周）**：
- 优化热力图的加载性能
- 添加数据缓存机制
- 完善移动端适配

**中期优化（1-2月）**：
- 支持自定义报表
- 添加数据对比功能（同比、环比）
- 优化导出格式（支持PDF）

**长期规划（3-6月）**：
- 智能预警（预测延迟风险）
- 数据可视化增强（更多图表类型）
- 与归档监控数据联动分析

---

## 十一、附录

### 附录A：URL参数设计

```
# 更新监控主页
/monitoring/update/?view_mode=project&target_code=PRJ001&year=2024

参数说明：
- view_mode: project|person (视图模式)
- target_code: 项目编码或经办人姓名
- year: 年度筛选
- project: 项目筛选

# 更新记录查询页
/monitoring/update-records/?time_range=week&modules=procurement,contract&person=张三

参数说明：
- time_range: week|month|year|custom
- start_date: 自定义开始日期
- end_date: 自定义结束日期
- modules: 模块列表（逗号分隔）
- person: 经办人
- project: 项目
- page: 页码
```

### 附录B：数据表关系

```
更新监控涉及的数据表：
- Procurement (采购)
- Contract (合同)
- Payment (付款)
- Settlement (结算)
- Project (项目)

关键字段：
- created_at: 录入日期
- updated_at: 更新日期
- business_date: 业务日期（公示日期/签订日期/付款日期/完成日期）
- responsible_person: 经办人
- project: 所属项目
```

### 附录C：准时率计算示例

**示例1：准时更新**
```
业务日期：2024-12-20
截止日期：2025-01-31（次月月底）
录入日期：2025-01-15
结论：准时（15 ≤ 31）
```

**示例2：延迟更新**
```
业务日期：2024-12-20
截止日期：2025-01-31
录入日期：2025-02-05
结论：延迟5天（2月5日 - 1月31日 = 5天）
```

**示例3：未录入**
```
业务日期：2024-12-20
截止日期：2025-01-31
录入日期：null（未录入）
当前日期：2025-02-10
结论：延迟10天（2月10日 - 1月31日 = 10天）
```

### 附录D：与归档监控对比表

| 对比项 | 归档监控 | 更新监控 |
|--------|---------|---------|
| 核心指标 | 归档周期、归档率 | 更新准时率 |
| 业务模块 | 采购、合同 | 采购、合同、付款、结算 |
| 特色功能 | 周期趋势图 | 热力图可视化 |
| 视图模式 | 项目视图、个人视图 | 项目视图、个人视图 |
| 详情展示 | 模态框 | 模态框 |
| 判断标准 | 规定天数内归档 | 次月月底前录入 |
| 新增功能 | 无 | 时间范围查询 |

---

## 文档更新记录

| 日期 | 版本 | 更新内容 | 更新人 |
|------|------|----------|--------|
| 2025-01-12 | v1.0 | 创建完整需求方案文档 | Documentation Writer |

---

## 审批流程

| 审批角色 | 审批人 | 审批日期 | 审批意见 |
|---------|--------|---------|---------|
| 需求提出人 | 待填写 | 待填写 | 待审批 |
| 技术负责人 | 待填写 | 待填写 | 待审批 |
| 项目经理 | 待填写 | 待填写 | 待审批 |

---

**文档状态**：✅ 待审核

**下一步行动**：
1. 召开需求评审会，确认方案可行性
2. 评估开发工作量和时间安排
3. 获得批准后进入开发阶段

---

*本文档最后更新: 2025-01-12*
