# 导出功能使用说明

## 概述

系统提供了完整的数据导出功能，支持将项目数据导出为Excel文件。导出的文件包含多个工作表，涵盖项目、采购、合同、付款、结算和供应商评价等所有模块的数据。

## 功能特性

### 1. 多工作表导出

导出的Excel文件包含以下工作表：

- **项目信息**：所有项目的基本信息
- **采购信息**：项目关联的采购记录
- **合同信息**：项目关联的合同记录（包含累计付款金额、付款笔数、付款比例等统计数据）
- **付款信息**：项目关联的付款记录
- **结算信息**：项目关联的结算记录
- **供应商评价**：项目关联的供应商评价记录
- **导出信息**：记录导出时间、导出人、各模块数据总数等元信息

### 2. 字段完整性

每个工作表都包含完整的字段信息，与导入模板保持一致，方便数据的二次编辑和重新导入。

### 3. 自动计算字段

合同工作表中包含以下自动计算的字段：
- 累计付款金额：合同的所有付款记录总和
- 付款笔数：合同的付款记录数量
- 付款比例：根据结算价或合同价计算的付款进度百分比

### 4. 时间戳记录

每条记录都包含创建时间和更新时间，导出信息工作表记录导出时间和导出人。

## 使用方法

### 在数据库管理页面导出

1. 登录系统管理员账户
2. 进入"数据库管理"页面（路径：首页 → 数据库管理）
3. 在"快速操作"区域，点击"导出数据"按钮
4. 系统将自动生成Excel文件并下载

### 导出文件命名

导出的文件名格式为：`项目数据导出_YYYYMMDD_HHMMSS.xlsx`

例如：`项目数据导出_20251023_141530.xlsx`

## 数据结构说明

### 项目信息工作表

包含字段：
- 项目编码
- 项目名称
- 项目描述
- 项目负责人
- 项目状态
- 备注
- 创建时间
- 更新时间

### 采购信息工作表

包含字段：
- 项目编码
- 项目名称
- 招采编号
- 采购名称
- 采购单位
- 采购计划完成日期
- 采购需求书审批完成日期
- 招采经办人
- 需求部门
- 需求部门经办人及联系方式
- 预算金额（元）
- 采购控制价（元）
- 中标价（元）
- 采购平台
- 采购方式
- 评标方法
- 定标方法
- 开标日期
- 评标委员会成员
- 定标委员会成员
- 平台中标结果公示完成日期
- 中标通知书发放日期
- 中标人
- 中标人联系人及方式
- 投标担保形式及金额
- 中标单位投标担保退回日期
- 履约担保形式及金额
- 全程有无投诉
- 应招未招说明
- 招采费用（元）
- 资料归档日期
- 创建时间
- 更新时间

### 合同信息工作表

包含字段：
- 项目编码
- 项目名称
- 关联采购编号
- 合同类型
- 合同来源
- 关联主合同编号
- 序号
- 合同序号
- 合同编号
- 合同名称
- 合同签订经办人
- 甲方
- 乙方
- 乙方负责人及联系方式
- 合同文本内乙方联系人及方式
- 含税签约合同价（元）
- 合同签订日期
- 合同工期/服务期限
- 支付方式
- 履约担保退回时间
- 资料归档日期
- 累计付款金额（元）
- 付款笔数
- 付款比例
- 创建时间
- 更新时间

### 付款信息工作表

包含字段：
- 项目编码
- 项目名称
- 关联合同编号
- 合同名称
- 付款编号
- 实付金额(元)
- 付款日期
- 结算价（元）
- 是否办理结算
- 创建时间
- 更新时间

### 结算信息工作表

包含字段：
- 项目编码
- 项目名称
- 关联合同编号
- 合同名称
- 结算编号
- 最终结算金额(元)
- 完成日期
- 结算备注
- 创建时间
- 更新时间

### 供应商评价工作表

包含字段：
- 项目编码
- 项目名称
- 关联合同编号
- 合同名称
- 评价编号
- 供应商名称
- 评价日期区间
- 评价人员
- 评分
- 评价类型
- 创建时间
- 更新时间

### 导出信息工作表

包含字段：
- 导出时间
- 导出人
- 项目总数
- 采购总数
- 合同总数
- 付款总数
- 结算总数
- 评价总数

## 使用场景

### 1. 数据备份

定期导出全部数据作为Excel格式的备份，便于归档和查阅。

### 2. 数据分析

导出数据到Excel中，利用Excel的数据透视表、图表等功能进行深度分析。

### 3. 数据迁移

导出数据后，可以经过编辑和整理，重新导入到系统中，实现数据的迁移和更新。

### 4. 报表制作

基于导出的数据，在Excel中制作各类管理报表。

## 注意事项

1. **权限要求**：只有系统管理员（staff用户）才能使用导出功能
2. **数据量**：如果项目数据量很大，导出可能需要较长时间，请耐心等待
3. **文件格式**：导出的文件为`.xlsx`格式，需要使用Excel 2007或更高版本打开
4. **数据完整性**：导出的数据包含所有项目及其关联数据，确保数据的完整性
5. **时间格式**：所有日期时间字段统一使用`YYYY-MM-DD`或`YYYY-MM-DD HH:MM:SS`格式

## 技术说明

### 实现方式

导出功能使用以下技术栈：
- **后端框架**：Django
- **数据处理**：pandas
- **Excel生成**：openpyxl
- **响应格式**：application/vnd.openxmlformats-officedocument.spreadsheetml.sheet

### 性能优化

- 使用Django ORM的`select_related`和`prefetch_related`优化数据库查询
- 采用pandas的DataFrame进行高效的数据处理
- 使用BytesIO实现内存流式写入，避免临时文件

### 数据处理

- 自动处理空值和缺失值
- 日期时间字段格式化为字符串
- Decimal类型转换为float
- 布尔值转换为中文（是/否）

## 更新日志

### v1.0.0 (2025-10-23)

- 🎉 初始版本发布
- ✅ 支持全部项目数据导出
- ✅ 包含6个业务模块工作表
- ✅ 自动记录导出信息
- ✅ 在数据库管理页面提供导出入口

## 反馈与支持

如果在使用导出功能时遇到问题，请联系系统管理员或技术支持团队。