# 数据库查询工具使用说明

本项目提供了多种方式查询数据库数据，支持命令行操作。

## 工具概述

### 1. Python查询脚本 (`scripts/query_database.py`)
功能最全面的查询工具，支持多种输出格式和交互模式。

### 2. Windows批处理脚本 (`scripts/db_query.bat`)
Windows下的快捷执行方式。

### 3. Linux/Mac Shell脚本 (`scripts/db_query.sh`)
Linux/Mac下的快捷执行方式。

## 使用方法

### 基本查询

#### Windows系统
```bash
# 直接执行SQL查询
scripts\db_query.bat "SELECT * FROM contract_contract LIMIT 10"

# 以JSON格式输出
scripts\db_query.bat "SELECT * FROM contract_contract LIMIT 10" json

# 列出所有表
scripts\db_query.bat --list-tables

# 查看表结构
scripts\db_query.bat --describe contract_contract

# 统计表记录数
scripts\db_query.bat --count contract_contract
```

#### Linux/Mac系统
```bash
# 给脚本添加执行权限
chmod +x scripts/db_query.sh

# 直接执行SQL查询
./scripts/db_query.sh "SELECT * FROM contract_contract LIMIT 10"

# 以JSON格式输出
./scripts/db_query.sh "SELECT * FROM contract_contract LIMIT 10" json

# 列出所有表
./scripts/db_query.sh --list-tables

# 查看表结构
./scripts/db_query.sh --describe contract_contract

# 统计表记录数
./scripts/db_query.sh --count contract_contract
```

### 直接使用Python脚本

```bash
# 基本查询
python scripts/query_database.py "SELECT * FROM contract_contract LIMIT 5"

# 不同输出格式
python scripts/query_database.py "SELECT * FROM contract_contract LIMIT 5" --format table
python scripts/query_database.py "SELECT * FROM contract_contract LIMIT 5" --format csv
python scripts/query_database.py "SELECT * FROM contract_contract LIMIT 5" --format json

# 从文件读取SQL
python scripts/query_database.py --file sql/query.sql

# 特殊功能
python scripts/query_database.py --list-tables
python scripts/query_database.py --describe contract_contract
python scripts/query_database.py --count contract_contract
```

### 交互式模式

不提供SQL语句时，工具会进入交互式模式：

```bash
python scripts/query_database.py
# 或者
scripts\db_query.bat
# 或者
./scripts/db_query.sh
```

在交互式模式中，可以：
- 直接输入SQL语句执行
- 输入 `exit` 或 `quit` 退出

## 常用查询示例

### 1. 查看数据库表信息
```sql
-- 列出所有表
SELECT name FROM sqlite_master WHERE type='table' ORDER BY name;

-- 查看表结构
PRAGMA table_info(contract_contract);
```

### 2. 业务数据查询
```sql
-- 查看合同信息（前10条）
SELECT contract_code, contract_name, contract_amount 
FROM contract_contract 
LIMIT 10;

-- 统计各表记录数
SELECT 'contract_contract' as table_name, COUNT(*) as count FROM contract_contract
UNION ALL
SELECT 'payment_payment' as table_name, COUNT(*) as count FROM payment_payment
UNION ALL
SELECT 'procurement_procurement' as table_name, COUNT(*) as count FROM procurement_procurement;

-- 查看采购信息
SELECT procurement_code, procurement_name, procurement_amount 
FROM procurement_procurement 
ORDER BY procurement_amount DESC 
LIMIT 5;
```

### 3. 条件查询
```sql
-- 按合同类型查询
SELECT contract_code, contract_name, contract_type 
FROM contract_contract 
WHERE contract_type = '采购合同';

-- 按金额范围查询
SELECT contract_code, contract_name, contract_amount 
FROM contract_contract 
WHERE contract_amount > 100000;

-- 按日期查询
SELECT contract_code, contract_name, signing_date 
FROM contract_contract 
WHERE signing_date >= '2023-01-01';
```

## 输出格式说明

### 表格格式 (table)
默认格式，以表格形式展示数据，便于阅读。

### CSV格式 (csv)
逗号分隔值格式，便于导入Excel或其他数据分析工具。

### JSON格式 (json)
JSON格式，便于程序处理和API交互。

## 注意事项

1. **SQL注入风险**: 在生产环境中使用时，请注意SQL注入风险，特别是当查询参数来自用户输入时。

2. **数据库锁定**: 长时间运行的查询可能会锁定数据库，影响其他操作。

3. **性能考虑**: 对于大数据量表，建议添加LIMIT条件限制返回记录数。

4. **备份重要性**: 在执行UPDATE或DELETE操作前，请确保已备份数据库。

## 扩展功能

如果需要更复杂的功能，可以：
1. 修改 `scripts/query_database.py` 脚本
2. 创建新的管理命令 (`python manage.py your_command`)
3. 使用Django Admin界面进行可视化操作

## 相关文件

- `scripts/query_database.py` - 主查询脚本
- `scripts/db_query.bat` - Windows批处理脚本
- `scripts/db_query.sh` - Linux/Mac Shell脚本
- `scripts/count_tables.py` - 表统计脚本
- `scripts/check_table_data.py` - 业务数据检查脚本