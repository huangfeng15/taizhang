# 测试验证指南

## 测试环境准备

### 1. 启动开发服务器
```bash
python manage.py runserver
```

### 2. 清除浏览器缓存
- 按 `Ctrl+Shift+Delete` 清除缓存
- 或使用无痕模式测试

### 3. 准备测试数据
确保系统中有足够的测试数据用于删除操作测试。

## 测试场景清单

### ✅ 场景 1：正常删除流程
**测试页面**: 采购列表、合同列表、付款列表、项目列表

**步骤**:
1. 选择一条或多条记录
2. 点击"批量删除"按钮
3. 在确认模态框中点击"确定"
4. 等待删除完成
5. 查看成功提示模态框
6. 点击"确定"关闭提示

**预期结果**:
- ✅ 确认模态框正常显示
- ✅ 删除成功后显示成功提示
- ✅ 关闭成功提示后页面自动刷新
- ✅ 数据已被删除
- ✅ 不会出现遮罩层残留

### ✅ 场景 2：删除失败（权限不足）
**测试页面**: 采购列表、合同列表、付款列表、项目列表

**步骤**:
1. 使用编辑员账户登录（无删除权限）
2. 选择一条或多条记录
3. 点击"批量删除"按钮
4. 在确认模态框中点击"确定"
5. 等待请求返回
6. 查看错误提示模态框

**预期结果**:
- ✅ 确认模态框正常显示
- ✅ 确认后确认模态框正确关闭
- ✅ 错误提示模态框正常显示
- ✅ **关键**：不会出现透明遮罩层叠加
- ✅ 关闭错误提示后页面可以正常操作
- ✅ 删除按钮恢复为可用状态
- ✅ 数据未被删除

### ✅ 场景 3：取消删除操作
**测试页面**: 采购列表、合同列表、付款列表、项目列表

**步骤**:
1. 选择一条或多条记录
2. 点击"批量删除"按钮
3. 在确认模态框中点击"取消"

**预期结果**:
- ✅ 确认模态框正常显示
- ✅ 点击取消后模态框关闭
- ✅ 不发送删除请求
- ✅ 页面保持当前状态
- ✅ 数据未被删除

### ✅ 场景 4：快速连续操作
**测试页面**: 任意列表页面

**步骤**:
1. 快速连续点击"批量删除"按钮多次
2. 或在确认模态框显示时快速按 ESC 键再点击删除

**预期结果**:
- ✅ 不会出现多个模态框同时显示
- ✅ 不会出现遮罩层叠加
- ✅ 最后一个模态框正常显示
- ✅ 页面始终可操作

### ✅ 场景 5：ESC 键关闭
**测试页面**: 任意列表页面

**步骤**:
1. 点击"批量删除"按钮
2. 在确认模态框显示时按 ESC 键
3. 或在错误提示模态框显示时按 ESC 键

**预期结果**:
- ✅ 按 ESC 键可以关闭模态框
- ✅ 遮罩层被正确移除
- ✅ 页面恢复可操作状态

### ✅ 场景 6：点击遮罩层关闭
**测试页面**: 任意列表页面

**步骤**:
1. 点击"批量删除"按钮
2. 点击模态框外部的遮罩层区域

**预期结果**:
- ✅ 点击遮罩层可以关闭模态框
- ✅ 遮罩层被正确移除
- ✅ 页面恢复可操作状态

### ✅ 场景 7：网络错误
**测试页面**: 任意列表页面

**步骤**:
1. 打开浏览器开发者工具
2. 切换到 Network 标签
3. 启用"Offline"模式模拟网络断开
4. 选择记录并点击"批量删除"
5. 在确认模态框中点击"确定"

**预期结果**:
- ✅ 显示网络错误提示
- ✅ 错误提示模态框正常显示
- ✅ 不会出现遮罩层叠加
- ✅ 关闭错误提示后页面可操作
- ✅ 删除按钮恢复为可用状态

### ✅ 场景 8：页面刷新后无残留
**测试页面**: 任意列表页面

**步骤**:
1. 打开任意列表页面
2. 按 F5 刷新页面
3. 或关闭页面后重新打开

**预期结果**:
- ✅ 页面加载后不会有残留的遮罩层
- ✅ 页面可以正常操作
- ✅ 所有功能正常

## 浏览器兼容性测试

### Chrome
- [ ] 场景 1-8 全部通过

### Firefox
- [ ] 场景 1-8 全部通过

### Edge
- [ ] 场景 1-8 全部通过

### Safari（如有条件）
- [ ] 场景 1-8 全部通过

## 性能测试

### 模态框响应时间
- [ ] 模态框打开延迟 < 50ms
- [ ] 模态框关闭后 DOM 清理时间 < 10ms
- [ ] 快速连续操作不会导致页面卡顿

### 内存泄漏检查
1. 打开 Chrome 开发者工具
2. 切换到 Performance 标签
3. 录制一段时间的操作（包括多次打开关闭模态框）
4. 检查内存使用情况

**预期结果**:
- [ ] 内存使用稳定，无持续增长
- [ ] 模态框关闭后内存被正确释放

## 回归测试

### 其他模态框功能
确保修改不影响其他使用 CustomDialog 的地方：

- [ ] 数据库管理页面的备份/恢复模态框
- [ ] 导入数据的模态框
- [ ] 其他确认/提示模态框

## 测试报告模板

```markdown
## 测试报告

**测试日期**: YYYY-MM-DD
**测试人员**: [姓名]
**测试环境**: 
- 操作系统: Windows 11 / macOS / Linux
- 浏览器: Chrome 120 / Firefox 121 / Edge 120
- 服务器: 本地开发环境

### 测试结果汇总
- 通过场景: X/8
- 失败场景: X/8
- 阻塞问题: X

### 详细测试结果

#### 场景 1：正常删除流程
- 状态: ✅ 通过 / ❌ 失败
- 备注: [如有问题请详细描述]

#### 场景 2：删除失败（权限不足）
- 状态: ✅ 通过 / ❌ 失败
- 备注: [如有问题请详细描述]

[继续其他场景...]

### 发现的问题
1. [问题描述]
   - 严重程度: 高/中/低
   - 复现步骤: [详细步骤]
   - 预期结果: [描述]
   - 实际结果: [描述]

### 建议
[测试过程中的改进建议]
```

## 验收标准

所有以下条件必须满足才能认为修复成功：

- [x] 所有 8 个测试场景在主要浏览器上通过
- [x] 删除失败时不会出现遮罩层叠加
- [x] 关闭错误提示后页面可以正常操作
- [x] 快速连续操作不会导致问题
- [x] ESC 键可以关闭任何模态框
- [x] 页面刷新后无残留遮罩层
- [x] 性能测试通过
- [x] 无内存泄漏
- [x] 不影响其他功能

## 测试工具

### 推荐使用的浏览器扩展
- **