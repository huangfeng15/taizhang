## ADDED Requirements

### Requirement: 操作日志记录
系统SHALL自动记录除超级用户外所有用户的修改和新增操作,用于审计追踪。

#### Scenario: 记录普通用户的修改操作
- **WHEN** 普通用户或编辑员修改项目、采购、合同或付款数据
- **THEN** 系统应当记录操作类型(修改)、操作对象、操作时间、用户信息和变更内容

#### Scenario: 记录普通用户的新增操作
- **WHEN** 普通用户或编辑员新增项目、采购、合同或付款数据
- **THEN** 系统应当记录操作类型(新增)、操作对象、操作时间、用户信息

#### Scenario: 超级用户操作不记录
- **WHEN** 超级用户执行任何修改或新增操作
- **THEN** 系统不应当记录该操作日志

### Requirement: 操作日志查看
系统SHALL提供操作日志查看页面,展示所有记录的操作日志。

#### Scenario: 查看日志列表
- **WHEN** 用户访问操作日志页面
- **THEN** 系统应当显示日志列表,包含操作时间、用户、操作类型、操作对象等信息,按时间倒序排列

#### Scenario: 日志分页显示
- **WHEN** 日志记录超过单页显示数量
- **THEN** 系统应当提供分页功能,每页显示20条记录

### Requirement: 日志自动清理
系统SHALL自动清理超过保留期限的操作日志。

#### Scenario: 清理7天前的日志
- **WHEN** 执行日志清理任务
- **THEN** 系统应当删除创建时间超过7天的所有日志记录

#### Scenario: 定时执行清理
- **WHEN** 每天凌晨2点
- **THEN** 系统应当自动执行日志清理任务

### Requirement: 日志删除权限
系统SHALL仅允许超级用户手动删除操作日志。

#### Scenario: 超级用户删除日志
- **WHEN** 超级用户在日志页面点击删除按钮
- **THEN** 系统应当删除选中的日志记录并显示成功提示

#### Scenario: 普通用户无删除权限
- **WHEN** 普通用户或编辑员访问日志页面
- **THEN** 系统不应当显示删除按钮

### Requirement: 导航栏优化
系统SHALL优化左侧导航栏,移除重复的功能入口。

#### Scenario: 移除重复的系统管理入口
- **WHEN** 用户查看左侧导航栏
- **THEN** 系统不应当显示"系统管理"菜单项(保留右上角账户下拉菜单中的入口)

#### Scenario: 移除重复的使用手册入口
- **WHEN** 用户查看左侧导航栏
- **THEN** 系统不应当显示"使用手册"菜单项(保留右上角账户下拉菜单中的入口)

#### Scenario: 添加操作日志入口
- **WHEN** 用户查看左侧导航栏
- **THEN** 系统应当在监控中心下方显示"操作日志"菜单项

### Requirement: 日志数据模型
系统SHALL定义操作日志的数据结构。

#### Scenario: 日志字段定义
- **WHEN** 创建操作日志记录
- **THEN** 系统应当包含以下字段:用户(外键)、操作类型(新增/修改)、操作对象类型(项目/采购/合同/付款)、操作对象ID、操作时间、IP地址、变更内容(JSON格式)

#### Scenario: 日志索引优化
- **WHEN** 查询操作日志
- **THEN** 系统应当在created_at和user字段上建立数据库索引以优化查询性能

### Requirement: 异步日志记录
系统SHALL采用异步方式记录操作日志,避免影响主请求性能。

#### Scenario: 异步写入日志
- **WHEN** 用户执行修改或新增操作
- **THEN** 系统应当在响应用户请求后异步写入日志,不阻塞主请求