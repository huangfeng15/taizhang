## ADDED Requirements

### Requirement: 周报数据模型
系统 MUST 提供周报管理的核心数据模型,支持周报创建、编辑和状态管理。

**ID**: REQ-WR-001
**优先级**: 高

#### Scenario: 创建新周报
- **WHEN** 用户进入周报管理页面并点击"新建周报"
- **THEN** 系统应生成唯一的周报编号(格式: WR{年份}W{周数})
- **AND** 记录创建时间和创建人
- **AND** 初始状态设置为"草稿"
- **AND** 显示该周需要更新的未归档项目列表

#### Scenario: 提交周报
- **WHEN** 用户完成周报填写并点击"提交"
- **THEN** 系统应验证所有必填项已填写
- **AND** 更新周报状态为"已提交"
- **AND** 记录提交时间
- **AND** 禁止再次修改(除非退回草稿)

#### Scenario: 查看历史周报
- **WHEN** 用户在周报列表中选择某个历史周报
- **THEN** 系统应显示该周报的完整信息
- **AND** 显示该周更新的项目列表
- **AND** 显示该周未更新的项目列表
- **AND** 支持导出为Excel格式

### Requirement: 采购进度追踪
系统 MUST 支持采购项目在周报中的进度追踪,记录项目在7个阶段的演进过程。

**ID**: REQ-WR-002
**优先级**: 高

#### Scenario: 更新采购阶段
- **WHEN** 用户选择某个采购项目并更新其阶段
- **THEN** 系统应验证新阶段不低于当前阶段
- **AND** 根据新阶段显示对应的必填字段
- **AND** 保存阶段数据到JSON字段
- **AND** 更新最后修改时间

#### Scenario: 查看项目进度历史
- **WHEN** 用户点击某个采购项目的"进度历史"
- **THEN** 系统应显示该项目在各周报中的阶段变化
- **AND** 显示每个阶段的录入时间和录入人
- **AND** 显示各阶段填写的数据内容

### Requirement: 周报提醒系统
系统 MUST 在每周五自动向相关用户推送周报填写提醒。

**ID**: REQ-WR-003
**优先级**: 高

#### Scenario: 自动生成周报提醒
- **WHEN** 每周五17:00定时任务执行
- **THEN** 系统应查询所有未归档的采购项目
- **AND** 识别需要更新状态的项目
- **AND** 为每个相关用户生成提醒记录
- **AND** 提醒内容包含项目列表和待更新状态

#### Scenario: 用户查看提醒
- **WHEN** 用户登录系统或进入提醒中心
- **THEN** 系统应在导航栏显示未读提醒数量
- **AND** 点击提醒图标显示提醒列表
- **AND** 点击具体提醒可直接跳转到对应周报录入页面
- **AND** 查看提醒后标记为已读

#### Scenario: 提醒过期清理
- **WHEN** 提醒创建超过7天
- **THEN** 系统应自动清理该提醒记录
- **AND** 记录清理日志

### Requirement: 阶段性信息录入
系统 MUST 根据采购项目所处阶段,动态显示对应的必填字段和录入表单。

**ID**: REQ-WR-004
**优先级**: 高

#### Scenario: 阶段一录入(采购计划立项)
- **WHEN** 用户选择阶段为"完成采购计划立项"
- **THEN** 系统应显示以下必填字段:
  - 采购项目名称
  - 采购预算金额(元)
  - 计划结束采购时间
- **AND** 提供字段说明和示例
- **AND** 实时验证字段格式

#### Scenario: 阶段二录入(采购需求完成)
- **WHEN** 用户选择阶段为"完成采购需求"
- **THEN** 系统应显示以下必填字段:
  - 需求部门
  - 申请人联系电话(需求部门)
  - 采购需求书审批完成日期(OA)
- **AND** 自动继承阶段一已录入的信息
- **AND** 验证手机号码格式

#### Scenario: 阶段五录入(结果公示完成)
- **WHEN** 用户选择阶段为"完成结果公示"
- **THEN** 系统应显示以下字段录入方式:
  - 手动录入: 招采编号、采购类别、评标委员会成员、候选人公示期质疑情况
  - 爬虫自动填充: 提供"从阳光采购平台获取"按钮
- **AND** 用户输入平台URL后触发爬虫
- **AND** 爬虫成功后自动填充相关字段
- **AND** 允许用户修改爬虫填充的内容

### Requirement: 信息补录检测
系统 MUST 在用户跳过中间阶段时,自动检测上一阶段遗漏的信息并提示补录。

**ID**: REQ-WR-005
**优先级**: 高

#### Scenario: 检测遗漏字段
- **WHEN** 用户从阶段一直接跳到阶段三
- **THEN** 系统应分析阶段二的必填字段
- **AND** 识别未填写的字段
- **AND** 在当前录入界面同时显示遗漏字段
- **AND** 使用不同颜色标记遗漏字段(如橙色提示)

#### Scenario: 强制补录验证
- **WHEN** 用户填写完当前阶段信息并点击"保存"
- **THEN** 系统应验证所有历史遗漏字段已补全
- **AND** 如有未补全字段,显示错误提示并阻止保存
- **AND** 高亮显示未补全的字段
- **AND** 提供"补全所有必填项"的快捷提示

### Requirement: 周报Excel生成
系统 MUST 支持将周报数据导出为Excel格式,清晰展示本周项目更新情况。

**ID**: REQ-WR-006
**优先级**: 中

#### Scenario: 生成周报Excel
- **WHEN** 用户在周报详情页点击"导出Excel"
- **THEN** 系统应生成包含以下Sheet的Excel文件:
  - Sheet1: 本周更新项目(项目名称、更新阶段、录入时间、录入人)
  - Sheet2: 未更新项目(项目名称、当前阶段、上次更新时间)
  - Sheet3: 统计汇总(更新项目数、未更新项目数、各阶段分布)
- **AND** 文件名格式: 周报_{年份}年第{周数}周_{生成日期}.xlsx
- **AND** 自动下载到用户本地

#### Scenario: 批量导出多周周报
- **WHEN** 用户选择日期范围并点击"批量导出"
- **THEN** 系统应生成包含选定周数的Excel文件
- **AND** 每周一个Sheet
- **AND** 添加汇总Sheet展示趋势变化

### Requirement: 录入时间记录
系统 MUST 记录每个用户每次录入信息的时间,用于统计和追溯。

**ID**: REQ-WR-007
**优先级**: 中

#### Scenario: 记录录入时间
- **WHEN** 用户保存采购项目进度信息
- **THEN** 系统应在审计字段中记录:
  - 录入用户(created_by / updated_by)
  - 录入时间(created_at / updated_at)
  - 修改次数(通过操作日志追踪)
- **AND** 保留历史版本数据(JSON格式存储)

#### Scenario: 查看录入历史
- **WHEN** 管理员查看某个采购项目的录入历史
- **THEN** 系统应显示该项目的所有修改记录
- **AND** 显示每次修改的字段变化
- **AND** 显示修改人和修改时间
- **AND** 支持版本对比功能

### Requirement: 未完成周报持续提醒
系统 MUST 对未完成周报录入的用户持续显示提醒,直到完成录入。

**ID**: REQ-WR-008
**优先级**: 中

#### Scenario: 持续提醒显示
- **WHEN** 用户有未提交的草稿周报
- **THEN** 系统应在每次登录时显示提醒横幅
- **AND** 在周报管理页面顶部显示待完成提示
- **AND** 在导航栏显示提醒徽章

#### Scenario: 提醒消除条件
- **WHEN** 用户提交周报 或 周报被删除
- **THEN** 系统应移除所有相关提醒
- **AND** 更新提醒徽章数量
- **AND** 清理提醒记录