# Generated by Django 5.2.7 on 2025-11-07 08:42

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('contract', '0011_add_contract_type'),
        ('supplier_eval', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='SupplierInterview',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, help_text='记录创建时自动设置', verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='每次更新时自动更新', verbose_name='更新时间')),
                ('created_by', models.CharField(blank=True, help_text='创建该记录的用户', max_length=50, verbose_name='创建人')),
                ('updated_by', models.CharField(blank=True, help_text='最后更新该记录的用户', max_length=50, verbose_name='更新人')),
                ('id', models.AutoField(primary_key=True, serialize=False, verbose_name='约谈记录ID')),
                ('supplier_name', models.CharField(db_index=True, help_text='被约谈的供应商名称', max_length=200, verbose_name='供应商名称')),
                ('interview_type', models.CharField(choices=[('违约约谈', '违约约谈'), ('履约沟通', '履约沟通'), ('商务洽谈', '商务洽谈'), ('投标前沟通', '投标前沟通'), ('其他', '其他')], db_index=True, default='履约沟通', help_text='约谈的类型分类', max_length=20, verbose_name='约谈类型')),
                ('interview_date', models.DateField(db_index=True, help_text='约谈发生的日期', verbose_name='约谈日期')),
                ('interviewer', models.CharField(help_text='我方参与约谈的人员', max_length=100, verbose_name='约谈人')),
                ('supplier_representative', models.CharField(blank=True, help_text='供应商方参与约谈的人员', max_length=100, verbose_name='供应商代表')),
                ('reason', models.TextField(help_text='详细说明约谈的原因', verbose_name='约谈原因')),
                ('content', models.TextField(help_text='约谈的详细过程和讨论内容', verbose_name='约谈内容')),
                ('rectification_requirements', models.TextField(blank=True, help_text='对供应商提出的整改要求（违约约谈时填写）', verbose_name='整改要求')),
                ('result', models.TextField(blank=True, help_text='约谈后的处理结果和后续跟进情况', verbose_name='处理结果')),
                ('status', models.CharField(choices=[('待整改', '待整改'), ('整改中', '整改中'), ('已完成', '已完成'), ('仅记录', '仅记录')], db_index=True, default='仅记录', help_text='约谈后的跟进状态', max_length=20, verbose_name='跟进状态')),
                ('has_contract', models.BooleanField(db_index=True, default=True, help_text='区分已签约供应商和潜在供应商', verbose_name='是否已签约供应商')),
                ('attachments', models.TextField(blank=True, help_text='相关文件、照片等附件的说明', verbose_name='附件说明')),
            ],
            options={
                'verbose_name': '供应商约谈记录',
                'verbose_name_plural': '供应商约谈记录',
                'ordering': ['-interview_date', '-created_at'],
            },
        ),
        migrations.AlterModelOptions(
            name='supplierevaluation',
            options={'ordering': ['-created_at'], 'verbose_name': '供应商履约评价', 'verbose_name_plural': '供应商履约评价'},
        ),
        migrations.AddField(
            model_name='supplierevaluation',
            name='comprehensive_score',
            field=models.DecimalField(blank=True, db_index=True, decimal_places=2, help_text='可从CSV导入，或根据末次评价和过程评价自动计算（末次60% + 过程40%）', max_digits=5, null=True, verbose_name='履约综合评价得分'),
        ),
        migrations.AddField(
            model_name='supplierevaluation',
            name='irregular_evaluation_1',
            field=models.DecimalField(blank=True, decimal_places=2, help_text='过程评价之一', max_digits=5, null=True, verbose_name='第一次不定期评价得分'),
        ),
        migrations.AddField(
            model_name='supplierevaluation',
            name='irregular_evaluation_2',
            field=models.DecimalField(blank=True, decimal_places=2, help_text='过程评价之一', max_digits=5, null=True, verbose_name='第二次不定期评价得分'),
        ),
        migrations.AddField(
            model_name='supplierevaluation',
            name='last_evaluation_score',
            field=models.DecimalField(blank=True, db_index=True, decimal_places=2, help_text='权重60%，用于计算综合评分', max_digits=5, null=True, verbose_name='末次评价得分'),
        ),
        migrations.AddField(
            model_name='supplierevaluation',
            name='remarks',
            field=models.TextField(blank=True, help_text='其他说明信息', verbose_name='备注'),
        ),
        migrations.AddField(
            model_name='supplierevaluation',
            name='score_2019',
            field=models.DecimalField(blank=True, decimal_places=2, help_text='过程评价之一', max_digits=5, null=True, verbose_name='2019年度评价得分'),
        ),
        migrations.AddField(
            model_name='supplierevaluation',
            name='score_2020',
            field=models.DecimalField(blank=True, decimal_places=2, help_text='过程评价之一', max_digits=5, null=True, verbose_name='2020年度评价得分'),
        ),
        migrations.AddField(
            model_name='supplierevaluation',
            name='score_2021',
            field=models.DecimalField(blank=True, decimal_places=2, help_text='过程评价之一', max_digits=5, null=True, verbose_name='2021年度评价得分'),
        ),
        migrations.AddField(
            model_name='supplierevaluation',
            name='score_2022',
            field=models.DecimalField(blank=True, decimal_places=2, help_text='过程评价之一', max_digits=5, null=True, verbose_name='2022年度评价得分'),
        ),
        migrations.AddField(
            model_name='supplierevaluation',
            name='score_2023',
            field=models.DecimalField(blank=True, decimal_places=2, help_text='过程评价之一', max_digits=5, null=True, verbose_name='2023年度评价得分'),
        ),
        migrations.AddField(
            model_name='supplierevaluation',
            name='score_2024',
            field=models.DecimalField(blank=True, decimal_places=2, help_text='过程评价之一', max_digits=5, null=True, verbose_name='2024年度评价得分'),
        ),
        migrations.AddField(
            model_name='supplierevaluation',
            name='score_2025',
            field=models.DecimalField(blank=True, decimal_places=2, help_text='过程评价之一', max_digits=5, null=True, verbose_name='2025年度评价得分'),
        ),
        migrations.AlterField(
            model_name='supplierevaluation',
            name='contract',
            field=models.ForeignKey(help_text='该评价对应的合同（对应CSV的"合同序号"列）', on_delete=django.db.models.deletion.PROTECT, related_name='evaluations', to='contract.contract', verbose_name='关联合同'),
        ),
        migrations.AlterField(
            model_name='supplierevaluation',
            name='score',
            field=models.DecimalField(blank=True, decimal_places=2, help_text='满分100分（兼容旧字段）', max_digits=5, null=True, verbose_name='评分'),
        ),
        migrations.AlterField(
            model_name='supplierevaluation',
            name='supplier_name',
            field=models.CharField(db_index=True, help_text='被评价的供应商名称，从合同自动获取', max_length=200, verbose_name='供应商名称'),
        ),
        migrations.AddIndex(
            model_name='supplierevaluation',
            index=models.Index(fields=['comprehensive_score'], name='supplier_ev_compreh_0f4733_idx'),
        ),
        migrations.AddIndex(
            model_name='supplierevaluation',
            index=models.Index(fields=['last_evaluation_score'], name='supplier_ev_last_ev_b63ba1_idx'),
        ),
        migrations.AddField(
            model_name='supplierinterview',
            name='contract',
            field=models.ForeignKey(blank=True, help_text='如因合同问题约谈，则关联具体合同', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='interviews', to='contract.contract', verbose_name='关联合同'),
        ),
        migrations.AddIndex(
            model_name='supplierinterview',
            index=models.Index(fields=['supplier_name'], name='supplier_ev_supplie_a2b298_idx'),
        ),
        migrations.AddIndex(
            model_name='supplierinterview',
            index=models.Index(fields=['interview_date'], name='supplier_ev_intervi_51290f_idx'),
        ),
        migrations.AddIndex(
            model_name='supplierinterview',
            index=models.Index(fields=['interview_type'], name='supplier_ev_intervi_7631f6_idx'),
        ),
        migrations.AddIndex(
            model_name='supplierinterview',
            index=models.Index(fields=['status'], name='supplier_ev_status_12485d_idx'),
        ),
        migrations.AddIndex(
            model_name='supplierinterview',
            index=models.Index(fields=['has_contract'], name='supplier_ev_has_con_a932df_idx'),
        ),
    ]
