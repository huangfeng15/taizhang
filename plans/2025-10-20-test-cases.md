# 项目采购与成本管理系统 — 测试用例规划

**文档版本：** v1.0  
**编写日期：** 2025-10-20  
**关联文档：** [业务规则](../specs/合同分类业务规则.md) | [数据模型](2025-10-20-data-models.md)

---

## 1. 测试概述

### 1.1 测试目标

确保合同分类功能（采购合同 vs 直接签订合同）的正确实现，包括：
- 数据验证规则的准确性
- UI交互的友好性
- 统计查询的准确性
- 数据导入的可靠性

### 1.2 测试范围

| 测试模块 | 测试类型 | 优先级 |
|---------|---------|--------|
| Contract 模型验证 | 单元测试 | P0 |
| Admin 后台操作 | 功能测试 | P0 |
| 数据导入功能 | 集成测试 | P1 |
| 统计查询功能 | 功能测试 | P1 |
| 异常数据检测 | 功能测试 | P2 |

---

## 2. 核心测试用例

### 2.1 模型验证测试

#### TC-001：采购合同必须关联采购项目
- **测试目标：** 验证采购合同不关联采购时保存失败
- **预期结果：** 抛出 ValidationError

#### TC-002：直接签订合同不能关联采购项目  
- **测试目标：** 验证直接签订合同关联采购时保存失败
- **预期结果：** 抛出 ValidationError

#### TC-003：补充协议继承主合同属性
- **测试目标：** 验证补充协议自动继承主合同的 contract_source 和 procurement
- **预期结果：** 自动同步成功

### 2.2 Admin 功能测试

#### TC-101：列表页显示合同来源
- **验证点：** 列表页包含"合同来源"列
- **验证点：** 显示值准确（采购合同/直接签订）

#### TC-102：按合同来源筛选
- **验证点：** 过滤器正确工作
- **验证点：** 筛选结果准确

#### TC-103：按是否关联采购筛选
- **验证点：** 支持按 procurement 是否为空筛选
- **验证点：** 可与合同来源筛选组合使用

### 2.3 数据导入测试

#### TC-201：批量导入混合类型合同
- **测试数据：** 包含采购合同和直接签订合同的 Excel
- **验证点：** 两类合同均正确导入
- **验证点：** 关联关系正确

#### TC-202：导入异常数据处理
- **测试数据：** 包含不符合规则的数据
- **验证点：** 异常数据被拒绝
- **验证点：** 错误信息清晰

### 2.4 统计查询测试

#### TC-301：按来源统计合同数量
- **验证点：** 统计结果准确
- **验证点：** 分类清晰

#### TC-302：按来源统计合同金额
- **验证点：** 金额汇总准确
- **验证点：** 支持对比分析

---

## 3. 测试数据准备

### 3.1 采购项目数据（5条）
```
GC2025001 - 办公楼装修工程
GC2025002 - 设备采购项目  
GC2025003 - 信息化建设项目
GC2025004 - 物业服务采购
GC2025005 - 保洁服务采购
```

### 3.2 采购合同数据（8条）
```
HT2025001 - 办公楼装修合同（关联 GC2025001）
HT2025002 - 设备采购合同（关联 GC2025002）
...
```

### 3.3 直接签订合同数据（2条）
```
HT2025009 - 年度维保框架协议（无采购关联）
HT2025010 - 法律顾问服务合同（无采购关联）
```

---

## 4. 测试执行计划

### 4.1 测试优先级

| 优先级 | 测试范围 | 执行时机 |
|-------|---------|---------|
| P0 | 模型验证、Admin基础功能 | 开发完成后立即执行 |
| P1 | 数据导入、统计查询 | 集成测试阶段 |
| P2 | 异常检测、边界测试 | 上线前执行 |

### 4.2 验收标准

- ✅ P0 级别测试：100% 通过
- ✅ P1 级别测试：100% 通过  
- ✅ P2 级别测试：≥ 95% 通过
- ✅ 代码覆盖率：≥ 85%

---

## 5. 缺陷管理

### 5.1 缺陷等级

| 等级 | 定义 | 修复时间 |
|-----|------|---------|
| P0-致命 | 阻塞核心功能 | 立即修复 |
| P1-严重 | 影响主要功能 | 2个工作日 |
| P2-一般 | 影响次要功能 | 1周内 |
| P3-轻微 | UI/UX问题 | 下个迭代 |

---

**文档状态：** ✅ 已完成  
**下一步：** 在开发阶段逐步实施测试用例