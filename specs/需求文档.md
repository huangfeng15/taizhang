### **项目采购与成本管理系统 - 最终需求说明书 (Final Version)**

#### **1. 引言 (Introduction)**

* **1.1 编写目的：**
 本文档旨在明确“项目采购与成本管理系统”的功能与非功能性需求，为后续的系统设计、开发、测试及验收提供统一的基准和依据。
* **1.2 项目背景：**
 当前，项目相关的采购、合同、付款、结算及供应商履约数据分散于多个独立的Excel文件中。这种管理方式导致数据标准化程度低、关联性弱、追溯困难且统计分析效率低下。
* **1.3 项目目标：**
 开发一套部署在公司内部局域网的轻量级数据管理系统，实现核心业务数据的集中化、结构化和关联化管理，为项目管理提供一个统一、高效、可靠的数据查询与追溯平台。

#### **2. 系统整体描述**

* **2.1 系统范围：**
 * 本系统为数据管理与查阅平台，**不包含业务审批流**。
 * 一期开发范围覆盖**采购管理、合同管理、付款管理、结算管理、供应商履约评价**四大核心业务板块。
 * **变更管理模块**作为远期规划，**本次不纳入开发范围**。

* **2.2 用户及角色：**
 1. **系统管理员 (1人)：**
 * **职责：** 负责系统的部署、维护、数据库备份、用户账户创建与权限分配。
 * **权限：** 拥有系统的最高管理权限。
 2. **模块数据管理员 (部门内各版块负责人)：**
 * **职责：** 负责其分管业务板块的数据录入、导入、更新和维护，确保数据的准确性与及时性。
 * **权限：** 拥有其被授权模块的完整数据操作权限（增、删、改、查）。普通用户可以查看所有模块的数据。

#### **3. 核心功能需求 (Functional Requirements)**

**3.1 数据唯一标识核心原则**
* 系统**不使用**自动生成的ID。所有核心业务数据均采用用户录入的**业务编号**作为唯一标识（主键）。系统必须在后台对这些编号的唯一性进行严格校验。

**3.2 数据导入与预处理**
* **3.2.1 标准模板导入：** 系统提供基于标准“长表”格式的Excel模板，用于新数据的规范化录入和批量导入。
* **3.2.2 历史数据“宽表”智能转换导入 (关键功能)：**
 * **目标：** 解决付款、供应商评价等历史Excel台账中，数据按月份/季度/半年度列展开的“宽表”格式的导入难题。
 * **实现方案：**
 1. 系统提供专门的“历史数据导入”接口，用户上传原始的“宽表”Excel文件。
 2. 系统后台程序（推荐使用Python的Pandas库）自动读取文件，识别表头中的日期信息（如“2022年1月”、“2022年2月”等）。
 3. 程序自动将“宽表”数据进行“逆透视”（Unpivot/Melt）操作，将其转换为规范的“长表”格式。
 4. 例如，对于付款表，程序会为每个有金额的单元格生成一条独立的付款记录，包含`关联合同编号`、`付款日期`（取对应列的月份第一天）、`实付金额`等字段。
 5. 该功能将极大减轻数据迁移的工作量，实现历史数据的平滑过渡。

**3.3 核心业务模块字段详情**
* **基本规则：** 除 `采购项目名称` 和 `合同名称` 必须填写外，其余所有字段均**允许为空**。

* **3.3.1 采购管理 (Procurement)**
 * **主键：** `招采编号`
 * **字段列表：** `序号`, `招采编号`, `采购项目名称`, `采购单位`, `中标单位`, `中标单位联系人及方式`, `采购方式`, `采购类别` (枚举: 工程/货物/服务), `采购预算金额(元)`, `采购控制价（元）`, `中标金额（元）`, `计划结束采购时间`, `候选人公示结束时间`, `结果公示发布时间`, `中标通知书发放日期`, `采购经办人`, `需求部门`, `申请人联系电话（需求部门）`, `采购需求书审批完成日期（OA）`, `采购平台` (枚举: 8M平台/特区建工采购平台/工程建设交易中心), `资格审查方式`, `评标谈判方式`, `定标方法`, `公告发布时间`, `报名截止时间`, `开标时间`, `评标委员会成员`, `投标担保形式及金额（元）`, `投标担保退回日期`, `履约担保形式及金额（元）`, `候选人公示期质疑情况`, `应招未招说明`, `资料归档日期`。

* **3.3.2 合同管理 (Contract)**
 * **主键：** `合同编号`
 * **关联关系：**
   - 一个采购可关联多个合同
   - 一个主合同可关联多个补充协议
   - **重要说明：** 部分合同不需要关联采购项目（约占总数的极少数，通常为直接签订的框架协议或服务合同）
 * **合同分类：**
   - **采购合同：** 通过正式采购流程产生的合同，必须关联采购项目（占绝大多数）
   - **直接签订合同：** 不经过采购流程直接签订的合同，无需关联采购项目（极少数情况）
 * **字段列表：** `序号`, `合同序号`, `合同编号`, `合同名称`, `合同签订经办人`, `合同类型` (枚举: 主合同/补充协议/解除协议), `合同来源` (枚举: 采购合同/直接签订), `关联主合同编号` (当类型为补充协议时必填), `关联采购编号` (当来源为采购合同时必填), `甲方`, `乙方`, `含税签约合同价（元）`, `合同签订日期`, `甲方法定代表人及联系方式`, `甲方联系人及联系方式`, `甲方负责人及联系方式`, `乙方法定代表人及联系方式`, `乙方联系人及联系方式`, `乙方负责人及联系方式`, `合同工期/服务期限`, `支付方式`, `履约担保退回时间`, `资料归档日期`。

* **3.3.3 付款管理 (Payment)**
 * **主键：** `付款编号` (用户自定义，建议格式: `[合同编号]-FK-[序号]`)
 * **字段列表：** `付款编号`, `关联合同编号`, `实付金额`, `付款日期`。

* **3.3.4 结算管理 (Settlement)**
 * **主键：** `结算编号` (用户自定义，通常与合同编号一致)
 * **字段列表：** `结算编号`, `关联合同编号`, `最终结算金额`, `完成日期`。

* **3.3.5 供应商履约评价 (Supplier Performance)**
 * **主键：** `评价编号` (用户自定义，建议格式: `[合同编号]-PJ-[序号]`)
 * **字段列表：** `评价编号`, `关联合同编号`, `供应商名称`, `评价日期区间`, `评价人员`, `评分`, `评价类型` (枚举: 末次评价/履约过程评价)。

**3.4 数据查询与视图**
* **3.4.1 项目总览仪表盘：** 以项目为维度，宏观展示各项目的核心成本指标，如合同总金额（含补充协议）、累计付款金额、付款进度等。
* **3.4.2 全局穿透式查询：** 提供强大的全局搜索功能，支持通过供应商名称、项目名称、合同编号等业务关键字进行全局搜索，并能查看所有关联数据。
* **3.4.3 关联数据清晰展示：** 在任何数据的详情页面（如付款单），都必须提供清晰的超链接，能够一键跳转到其关联的合同、采购等信息页面，形成完整的数据追溯链条。
* **3.4.4 合同分类统计：** 支持按合同来源（采购合同/直接签订）进行统计分析，提供以下统计维度：
  - 采购合同数量、金额、付款情况
  - 直接签订合同数量、金额、付款情况
  - 关联采购的合同 vs 不关联采购的合同对比分析
  - 支持在列表页通过筛选器快速定位不同类型的合同

**3.5 业务规则**
* **3.5.1 合同-采购关联规则：**
  - 采购合同必须关联采购项目，系统应在保存时进行强制校验
  - 直接签订合同不能关联采购项目
  - 补充协议自动继承主合同的来源类型和采购关联关系
* **3.5.2 数据一致性保护：**
  - 删除采购项目前，必须先解除所有关联合同的关联关系
  - 合同来源类型变更时，系统应给予明确提示

#### **4. 非功能性需求 (Non-Functional Requirements)**

* **4.1 性能要求：**
 * **响应时间：** 页面加载和常规数据查询响应时间应控制在**3秒**以内。
 * **数据加载：** 对于可能存在大量数据的列表（如付款记录），必须实现**分页加载**，避免一次性加载过多数据导致页面卡顿。
* **4.2 可靠性与稳定性：**
 * 系统应保证在工作时间内7x24小时稳定运行，避免无故中断或服务不可用。
 * 后端服务应有完善的错误处理和日志记录机制，便于问题排查。
* **4.3 部署与维护：**
 * 系统需提供详细的部署文档，便于在Windows Server上进行安装和配置。
 * 数据库应配置定期（如每日凌晨）的**自动备份**策略。

#### **5. 技术架构与部署方案**

* **5.1 技术选型原则：**
 * 本系统为部门内部使用的轻量级系统，用户数量有限（系统管理员+部门负责人）
 * 数据量预计在10万条以内，重点追求**简单易维护、快速上线、学习成本低**
 * 采用**渐进式技术方案**，从最简单方案开始，根据实际需要逐步优化

* **5.2 推荐技术方案（分阶段实施）：**

**阶段一：MVP最小可行产品（推荐初学者，2周内可上线）**
 * **后端框架：** **Python + Django** + Django Admin（无需编写前端代码）
 * **数据库：** **SQLite**（零配置，文件型数据库，备份=复制文件）
 * **部署方式：** Django内置开发服务器（一行命令启动，局域网直接访问）
 * **优势：** 学习成本最低，维护简单，2周内实现全部核心功能
 * **适用场景：** 数据量<10万条，用户数<20人，对界面美观度要求不高

**阶段二：标准方案（有一定经验后，额外2-3周开发）**
 * **前端框架：** **Vue.js 3 + Element Plus**（不使用TypeScript，降低学习难度）
 * **数据库：** 继续使用**SQLite**（性能完全满足需求）
 * **部署方式：** **Waitress**（比开发服务器更稳定）+ Windows任务计划程序
 * **优势：** 界面更美观，用户体验更好
 * **适用场景：** 希望提升用户体验，有时间开发自定义界面

**阶段三：企业方案（可选，仅在必要时升级）**
 * **数据库：** 升级到**PostgreSQL**（数据量>50万条时）
 * **Web服务器：** **Nginx** + Waitress（并发访问>100人时）
 * **前端技术：** 引入TypeScript（团队技术水平提升后）
 * **部署方式：** NSSM配置Windows服务
 * **适用场景：** 系统规模扩大，对性能和并发有更高要求

* **5.3 部署环境要求：**
 * **服务器：** 公司内部的**Windows Server**或普通Windows PC
 * **最低配置：** 2核CPU + 4GB内存 + 50GB磁盘（阶段一、二）
 * **推荐配置：** 4核CPU + 8GB内存 + 100GB磁盘（阶段三）

* **5.4 数据库备份策略：**
 * **SQLite方案：** 使用Windows任务计划程序，每日凌晨自动复制数据库文件到备份目录
 * **PostgreSQL方案：** 使用pg_dump工具进行自动备份

* **5.5 技术方案选择建议：**
 * **如果你是初学者：** 强烈推荐从**阶段一**开始，使用Django Admin快速实现功能
 * **如果你有Python/爬虫经验：** 可以从**阶段一**开始，2周后评估是否需要进入**阶段二**
 * **如果你是经验丰富的开发者：** 可以直接选择**阶段二**或**阶段三**方案

**重要提示：** 不要过早优化！先让系统运行起来，根据实际使用情况再决定是否升级。大多数情况下，**阶段一**的方案就能完全满足需求。

---

这份文档凝聚了我们所有的讨论成果，是指导项目从0到1的纲领性文件。