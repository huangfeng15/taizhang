{% extends "base.html" %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">{{ page_title }}</h2>
        <div class="text-muted">
            <i class="fas fa-filter"></i>
            å½“å‰ç­›é€‰ï¼š{{ filter_config.display_year|default:"å…¨éƒ¨å¹´åº¦" }}
            {% if filter_config.selected_project_value %}Â· {{ filter_config.selected_project_value }}{% else %}Â· å…¨éƒ¨é¡¹ç›®{% endif %}
        </div>
    </div>

    <!-- æ—¶é—´ç»´åº¦åˆ‡æ¢ -->
    <div class="btn-group mb-3" role="group">
        <a href="?time_dimension=current_month{% if selected_project %}&project={{ selected_project }}{% endif %}{% if selected_person %}&responsible_person={{ selected_person }}{% endif %}"
           class="btn btn-{% if time_dimension == 'current_month' %}primary{% else %}outline-primary{% endif %}">æœ¬æœˆ</a>
        <a href="?time_dimension=last_month{% if selected_project %}&project={{ selected_project }}{% endif %}{% if selected_person %}&responsible_person={{ selected_person }}{% endif %}"
           class="btn btn-{% if time_dimension == 'last_month' %}primary{% else %}outline-primary{% endif %}">ä¸Šæœˆ</a>
        <a href="?time_dimension=current_year{% if selected_project %}&project={{ selected_project }}{% endif %}{% if selected_person %}&responsible_person={{ selected_person }}{% endif %}"
           class="btn btn-{% if time_dimension == 'current_year' %}primary{% else %}outline-primary{% endif %}">æœ¬å¹´åº¦</a>
    </div>

    <!-- KPIå¡ç‰‡ -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">å‡†æ—¶äº‹ä»¶</h5>
                    <h2 class="text-success">{{ statistics.on_time_count }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">å»¶è¿Ÿäº‹ä»¶</h5>
                    <h2 class="text-danger">{{ statistics.delayed_count }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">å‡†æ—¶ç‡</h5>
                    <h2 class="text-primary">{{ statistics.on_time_rate }}%</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">æ€»äº‹ä»¶æ•°</h5>
                    <h2 class="text-secondary">{{ statistics.total_events }}</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- ç­›é€‰æ  -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <input type="hidden" name="time_dimension" value="{{ time_dimension }}">
                <div class="col-md-3">
                    <label class="form-label">é¡¹ç›®</label>
                    <input type="text" name="project" class="form-control" value="{{ selected_project }}" placeholder="é¡¹ç›®ç¼–ç ">
                </div>
                <div class="col-md-3">
                    <label class="form-label">ç»åŠäºº</label>
                    <input type="text" name="responsible_person" class="form-control" value="{{ selected_person }}" placeholder="ç»åŠäººå§“å">
                </div>
                <div class="col-md-2">
                    <label class="form-label d-block">&nbsp;</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="show_all" value="true" id="showAllCheck" {% if show_all %}checked{% endif %}>
                        <label class="form-check-label" for="showAllCheck">
                            æ˜¾ç¤ºæ‰€æœ‰è®°å½•
                        </label>
                    </div>
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary me-2">ç­›é€‰</button>
                    <a href="?time_dimension={{ time_dimension }}" class="btn btn-secondary">é‡ç½®</a>
                </div>
            </form>
        </div>
    </div>

    <!-- é—®é¢˜åˆ—è¡¨ -->
    {% if problems.upcoming %}
    <div class="card mb-3">
        <div class="card-header bg-warning">
            <h5 class="mb-0">âš ï¸ å³å°†åˆ°æœŸï¼ˆ3å¤©å†…ï¼‰- {{ problems.upcoming|length }}æ¡</h5>
        </div>
        <div class="card-body p-0">
            {% include "monitoring/includes/update_list_table.html" with items=problems.upcoming %}
        </div>
    </div>
    {% endif %}

    {% if problems.delayed %}
    <div class="card mb-3">
        <div class="card-header bg-danger text-white">
            <h5 class="mb-0">ğŸ”´ å·²å»¶è¿Ÿ - {{ problems.delayed|length }}æ¡</h5>
        </div>
        <div class="card-body p-0">
            {% include "monitoring/includes/update_list_table.html" with items=problems.delayed %}
        </div>
    </div>
    {% endif %}

    {% if show_all and problems.completed %}
    <div class="card mb-3">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0">âœ… å·²å®Œæˆ - {{ problems.completed|length }}æ¡</h5>
        </div>
        <div class="card-body p-0">
            {% include "monitoring/includes/update_list_table.html" with items=problems.completed %}
        </div>
    </div>
    {% endif %}

    {% if statistics.total_events == 0 %}
    <div class="alert alert-success text-center">
        <h4>âœ… å¤ªæ£’äº†ï¼æ‰€æœ‰äº‹ä»¶éƒ½å·²æŒ‰æ—¶æ›´æ–°</h4>
    </div>
    {% endif %}
</div>

{% endblock %}
