<div class="pagination"
     id="pagination-{{ anchor_id|default:'default' }}"
     data-preserve-pagination="true"
     data-pagination-key="{{ request.path }}#{{ anchor_id|default:'default' }}">
    {% if show_info|default:True %}
        <span class="pagination-info">
            显示第 {{ page_obj.start_index }} - {{ page_obj.end_index }} 条，共 {{ page_obj.paginator.count }} 条
        </span>
    {% endif %}

    {% if page_obj.has_other_pages %}
        {% with page_param=page_param|default:'page' %}
        {% with base_qs=querystring|default:request.GET.urlencode %}

        {% if page_obj.has_previous %}
            <a href="{{ request.path }}?{% if base_qs %}{{ base_qs }}&{% endif %}{{ page_param }}=1" class="pagination-btn pagination-no-scroll">
                <i class="fas fa-angle-double-left"></i> 首页
            </a>
            <a href="{{ request.path }}?{% if base_qs %}{{ base_qs }}&{% endif %}{{ page_param }}={{ page_obj.previous_page_number }}" class="pagination-btn pagination-no-scroll">
                <i class="fas fa-angle-left"></i> 上一页
            </a>
        {% else %}
            <span class="pagination-btn disabled">
                <i class="fas fa-angle-double-left"></i> 首页
            </span>
            <span class="pagination-btn disabled">
                <i class="fas fa-angle-left"></i> 上一页
            </span>
        {% endif %}

        <div class="page-numbers">
            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                    <span class="current">{{ num }}</span>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <a href="{{ request.path }}?{% if base_qs %}{{ base_qs }}&{% endif %}{{ page_param }}={{ num }}" class="pagination-no-scroll">{{ num }}</a>
                {% elif num == 1 or num == page_obj.paginator.num_pages %}
                    <a href="{{ request.path }}?{% if base_qs %}{{ base_qs }}&{% endif %}{{ page_param }}={{ num }}" class="pagination-no-scroll">{{ num }}</a>
                {% elif num == page_obj.number|add:'-3' or num == page_obj.number|add:'3' %}
                    <span class="ellipsis">...</span>
                {% endif %}
            {% endfor %}
        </div>

        {% if page_obj.has_next %}
            <a href="{{ request.path }}?{% if base_qs %}{{ base_qs }}&{% endif %}{{ page_param }}={{ page_obj.next_page_number }}" class="pagination-btn pagination-no-scroll">
                下一页 <i class="fas fa-angle-right"></i>
            </a>
            <a href="{{ request.path }}?{% if base_qs %}{{ base_qs }}&{% endif %}{{ page_param }}={{ page_obj.paginator.num_pages }}" class="pagination-btn pagination-no-scroll">
                末页 <i class="fas fa-angle-double-right"></i>
            </a>
        {% else %}
            <span class="pagination-btn disabled">
                下一页 <i class="fas fa-angle-right"></i>
            </span>
            <span class="pagination-btn disabled">
                末页 <i class="fas fa-angle-double-right"></i>
            </span>
        {% endif %}

        {% endwith %}
        {% endwith %}
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('pagination-{{ anchor_id|default:"default" }}');
    if (!container) {
        return;
    }
    const keyBase = container.dataset.paginationKey || (window.location.pathname + window.location.search);
    const storageKey = 'paginationScroll:' + keyBase;
    const savedPositionRaw = sessionStorage.getItem(storageKey);
    if (savedPositionRaw !== null) {
        const savedPosition = parseInt(savedPositionRaw, 10);
        if (!Number.isNaN(savedPosition)) {
            window.scrollTo({ top: savedPosition, behavior: 'auto' });
        }
        sessionStorage.removeItem(storageKey);
    }

    container.querySelectorAll('.pagination-no-scroll').forEach(function(link) {
        link.addEventListener('click', function() {
            const currentTop = window.pageYOffset || document.documentElement.scrollTop || 0;
            sessionStorage.setItem(storageKey, currentTop);
        });
    });
});
</script>

<style>
.pagination {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-top: 20px;
    padding: 15px;
    flex-wrap: wrap;
}

.pagination-info {
    color: #666;
    font-size: 14px;
    margin-right: 20px;
}

.pagination-btn {
    padding: 6px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    background: white;
    color: #333;
    text-decoration: none;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
}

.pagination-btn:hover:not(.disabled) {
    background: #1890ff;
    color: white;
    border-color: #1890ff;
}

.pagination-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: #f5f5f5;
}

.page-numbers {
    display: flex;
    gap: 5px;
    align-items: center;
}

.page-numbers a,
.page-numbers span {
    padding: 6px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    text-decoration: none;
    color: #333;
    font-size: 14px;
    min-width: 36px;
    text-align: center;
    transition: all 0.3s;
}

.page-numbers a:hover {
    background: #1890ff;
    color: white;
    border-color: #1890ff;
}

.page-numbers span.current {
    background: #1890ff;
    color: white;
    border-color: #1890ff;
    font-weight: bold;
}

.page-numbers span.ellipsis {
    border: none;
    cursor: default;
}
</style>
