# PDF字段提取配置
# 版本: 3.0 - 通用性增强版
# 说明: 采用多pattern策略和fallback机制，提高不同PDF格式的适应性

version: "3.0"
description: "采购信息PDF智能提取配置 - 增强通用性和鲁棒性"

# 通用性策略说明
# 1. 多pattern策略：每个字段配置2-3个备选pattern，按优先级尝试
# 2. Fallback机制：primary pattern失败时自动尝试backup pattern
# 3. 宽松匹配：使用更通用的正则表达式，适应不同格式
# 4. 智能清理：提取后自动清理多余空白和特殊字符

strategy:
  conflict_resolution: "single_source"
  multi_pattern_enabled: true      # 启用多pattern策略
  fallback_enabled: true            # 启用fallback机制
  auto_clean: true                  # 自动清理提取结果

# 字段配置（增强版）
fields:
  # ===== 手动字段 =====
  procurement_code:
    label: "招采编号"
    required: true
    data_type: "string"
    source:
      manual: true
  
  project:
    label: "关联项目"
    required: false
    data_type: "foreign_key"
    source:
      manual: true
  
  # ===== 自动提取字段 - 采用多pattern策略 =====
  
  # 项目名称 - 3种pattern适应不同格式
  project_name:
    label: "采购项目名称"
    required: true
    data_type: "string"
    source:
      pdf_type: "procurement_notice"
      extraction:
        method: "regex"
        # Pattern优先级：具体 → 一般 → 宽松
        pattern: "项目名称[：:\\s]*([\\s\\S]+?)(?=项目编号|\\n标段|\\n采购)"  # 主pattern
        fallback_pattern: "(?:采购)?项目名称[：:\\s]*(.{10,200}?)(?=\\n[^\\s])"  # 备用pattern
  
  # 采购单位
  procurement_unit:
    label: "采购单位"
    required: false
    data_type: "string"
    source:
      pdf_type: "procurement_notice"
      extraction:
        method: "regex"
        pattern: "单位名称[：:\\s]*([^\\n]+?)(?=单位地址|\\n)"
        fallback_pattern: "采购[人单位][：:\\s]*([^\\n]{5,100})"
  
  # 采购类别 - 从项目类型提取并映射
  procurement_category:
    label: "采购类别"
    required: false
    data_type: "choice"
    choices:
      - "工程"
      - "工程货物"
      - "工程服务"
      - "货物"
      - "服务"
    aliases:
      "服务类": "服务"
      "货物类": "货物"
      "工程类": "工程"
      "地产营销类": "服务"
      "地产营销": "服务"
    source:
      pdf_type: "procurement_notice"
      extraction:
        method: "regex"
        pattern: "项目类型[：:\\s]*([^\\n]+)"
        fallback_pattern: "标段/?包分类[：:\\s]*[A-Z]-[^/\\n]*/\\s*([^\\n]+)"
  
  # 采购平台 - 关键词识别
  procurement_platform:
    label: "采购平台"
    required: false
    data_type: "string"
    source:
      pdf_type: "procurement_notice"
      extraction:
        method: "regex"
        pattern: "(特区建工|阳光采购)[^\\n]*平台"
        fallback_pattern: "平台[：:\\s]*([^\\n]+)"
        default_value: "特区建工采购平台"  # 兜底值
  
  # 采购方式 - 关键词匹配
  procurement_method:
    label: "采购方式"
    required: false
    data_type: "choice"
    choices:
      - "公开招标"
      - "邀请招标"
      - "公开询价"
      - "邀请询价"
      - "公开竞价"
      - "邀请竞价"
      - "公开比选"
      - "邀请比选"
      - "单一来源采购"
      - "公开竞争性谈判"
      - "公开竞争性磋商"
      - "邀请竞争性谈判"
      - "邀请竞争性磋商"
      - "直接采购"
      - "战采结果应用"
    aliases:
      "询价": "公开询价"
      "竞争性谈判": "公开竞争性谈判"
      "竞争性磋商": "公开竞争性磋商"
      "招标": "公开招标"
    source:
      pdf_type: "procurement_notice"
      extraction:
        method: "regex"
        pattern: "采购方式[：:\\s]*([^\\n]+)"
        fallback_pattern: "(公开|邀请)?(招标|询价|竞价|比选|竞争性谈判|竞争性磋商)"
  
  # 资格审查方式
  qualification_review_method:
    label: "资格审查方式"
    required: false
    data_type: "choice"
    choices:
      - "资格预审"
      - "资格后审"
      - "投标报名"
    source:
      pdf_type: "procurement_notice"
      extraction:
        method: "regex"
        pattern: "资格审查[方式]*[：:\\s]*([^\\n]+)"
        fallback_pattern: "(资格预审|资格后审|投标报名)"
  
  # 评标方式
  bid_evaluation_method:
    label: "评标谈判方式"
    required: false
    data_type: "choice"
    choices:
      - "综合评分法"
      - "竞争性谈判"
      - "价格竞争法"
      - "定性评审法"
    aliases:
      "综合评估法": "综合评分法"
      "综合评审法": "综合评分法"
      "最低价法": "价格竞争法"
      "经评审的合理低价法": "价格竞争法"
    source:
      pdf_type: "procurement_notice"
      extraction:
        method: "regex"
        pattern: "评[审标][办法方式]*[：:\\s]*([^\\n]+?)(?=\\n|是否)"
        fallback_pattern: "(综合评[分估审]法|竞争性谈判|价格竞争法|最低价法|定性评审法)"
  
  # 定标方法
  bid_awarding_method:
    label: "定标方法"
    required: false
    data_type: "choice"
    choices:
      - "竞争定标法"
      - "票决定标法"
      - "集体议事法"
    aliases:
      "票决法": "票决定标法"
    source:
      pdf_type: "procurement_request"
      extraction:
        method: "regex"
        pattern: "定标方法[：:\\s]*([^\\n]+)"
        fallback_pattern: "(竞争定标法|票决定标法|集体议事法)"
  
  # 金额字段 - 宽松匹配货币符号和数字格式
  budget_amount:
    label: "采购预算金额(元)"
    required: false
    data_type: "decimal"
    source:
      pdf_type: "procurement_request"
      extraction:
        method: "regex"
        pattern: "采购预算[金额]*\\s*[（(]?元[）)]?[：:\\s]*[￥¥]?([\\d,]+\\.?\\d*)"
        fallback_pattern: "预算[：:\\s]*[￥¥]?([\\d,]+\\.?\\d*)\\s*元?"
  
  control_price:
    label: "采购控制价(元)"
    required: false
    data_type: "decimal"
    source:
      pdf_type: "procurement_notice"
      extraction:
        method: "regex"
        pattern: "采购控制价\\s*[（(]?元[）)]?[：:\\s]*[￥¥]([\\d,]+\\.?\\d*)"
        fallback_pattern: "控制价[：:\\s]*[￥¥]?([\\d,]+\\.?\\d*)|上限价[：:\\s]*[￥¥]?([\\d,]+\\.?\\d*)"
  
  winning_amount:
    label: "中标金额(元)"
    required: false
    data_type: "decimal"
    source:
      pdf_type: "result_publicity"
      extraction:
        method: "regex"
        pattern: "[￥¥]([\\d,]+\\.?\\d*)\\s*[^\\n]*元整"
        fallback_pattern: "成交价[：:\\s]*[￥¥]?([\\d,]+\\.?\\d*)|中标[金额价]*[：:\\s]*[￥¥]?([\\d,]+\\.?\\d*)"
  
  # 人员信息
  procurement_officer:
    label: "采购经办人"
    required: false
    data_type: "string"
    source:
      pdf_type: "procurement_request"
      extraction:
        method: "regex"
        pattern: "申请人[：:\\s]*([^\\n]+?)(?=申请单编号|所在部门|\\n)"
        fallback_pattern: "经办人[：:\\s]*([^\\n]+)"
  
  demand_department:
    label: "需求部门"
    required: false
    data_type: "string"
    source:
      pdf_type: "procurement_request"
      extraction:
        method: "regex"
        pattern: "(?:所在)?部门[：:\\s]*([^\\n]+?)(?=创建时间|\\n)"
        fallback_pattern: "需求部门[：:\\s]*([^\\n]+)"
  
  demand_contact:
    label: "申请人联系电话"
    required: false
    data_type: "string"
    source:
      pdf_type: "procurement_notice"
      extraction:
        method: "regex"
        pattern: "采购[人单位]*联系电话[：:\\s]*(\\d{7,15})"
        fallback_pattern: "联系电话[：:\\s]*(\\d{7,15})|(1[3-9]\\d{9})"
  
  # 中标信息
  winning_bidder:
    label: "中标单位"
    required: false
    data_type: "string"
    source:
      pdf_type: "result_publicity"
      extraction:
        method: "regex"
        pattern: "(?:第?一|1)\\s*([^\\n￥]{5,50}?)(?=\\s*[￥¥])"
        fallback_pattern: "成交[人单位]*[：:\\s]*([^\\n￥]+?)(?=\\s*[￥¥])|中标[人单位]*[：:\\s]*([^\\n]+)"
  
  winning_contact:
    label: "中标单位联系人及方式"
    required: false
    data_type: "string"
    source:
      manual: true
  
  # 时间字段 - 统一的日期格式匹配
  planned_completion_date:
    label: "计划结束采购时间"
    required: false
    data_type: "date"
    source:
      pdf_type: "procurement_request"
      extraction:
        method: "regex"
        pattern: "计划[完成结束]*时间[：:\\s]*([\\d-]{8,10})"
        fallback_pattern: "(20\\d{2}-\\d{1,2}-\\d{1,2})"
  
  requirement_approval_date:
    label: "采购需求书审批完成日期"
    required: false
    data_type: "date"
    source:
      pdf_type: "procurement_request"
      extraction:
        method: "regex"
        pattern: "创建时间[：:\\s]*([\\d-]{8,10})"
        fallback_pattern: "审批.*?时间[：:\\s]*([\\d-]{8,10})"
  
  announcement_release_date:
    label: "公告发布时间"
    required: false
    data_type: "date"
    source:
      pdf_type: "procurement_notice"
      extraction:
        method: "regex"
        pattern: "(?:询价)?公告发布时间[：:\\s]*([\\d-]{8,10})"
        fallback_pattern: "发布时间[：:\\s]*([\\d-]{8,10})"
  
  registration_deadline:
    label: "报名截止时间"
    required: false
    data_type: "date"
    source:
      pdf_type: "procurement_notice"
      extraction:
        method: "regex"
        pattern: "报名截止时间[：:\\s]*([\\d-]{8,10})"
        fallback_pattern: "截止时间[：:\\s]*([\\d-]{8,10})"
  
  bid_opening_date:
    label: "开标时间"
    required: false
    data_type: "date"
    source:
      pdf_type: "procurement_notice"
      extraction:
        method: "regex"
        pattern: "开标时间[：:\\s]*([\\d-]{8,10})"
        fallback_pattern: "开标[：:\\s]*([\\d-]{8,10})"
  
  candidate_publicity_end_date:
    label: "候选人公示结束时间"
    required: false
    data_type: "date"
    source:
      pdf_type: "candidate_publicity"
      extraction:
        method: "regex"
        pattern: "公示结束时间[：:\\s]*([\\d-]{8,10})"
        fallback_pattern: "结束时间[：:\\s]*([\\d-]{8,10})"
  
  result_publicity_release_date:
    label: "结果公示发布时间"
    required: false
    data_type: "date"
    source:
      pdf_type: "result_publicity"
      extraction:
        method: "regex"
        pattern: "公示发布时间[：:\\s]*([\\d-]{8,10})"
        fallback_pattern: "发布时间[：:\\s]*([\\d-]{8,10})"
  
  notice_issue_date:
    label: "中标通知书发放日期"
    required: false
    data_type: "date"
    source:
      manual: true
  
  archive_date:
    label: "资料归档日期"
    required: false
    data_type: "date"
    source:
      manual: true
  
  # 其他信息
  evaluation_committee:
    label: "评标委员会成员"
    required: false
    data_type: "text"
    source:
      pdf_type: "procurement_request"
      extraction:
        method: "regex"
        pattern: "申请评审小组成员为[：:]([^。]+)"
        fallback_pattern: "评[审标].*?成员[：:]([^。]{10,200})"
  
  bid_guarantee:
    label: "投标担保形式及金额"
    required: false
    data_type: "string"
    source:
      manual: true
  
  bid_guarantee_return_date:
    label: "投标担保退回日期"
    required: false
    data_type: "date"
    source:
      manual: true
  
  performance_guarantee:
    label: "履约担保形式及金额"
    required: false
    data_type: "string"
    source:
      manual: true
  
  candidate_publicity_issue:
    label: 