<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>企业级数据监控中心</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.3/dist/echarts.min.js"></script>
    <style>
        :root {
            --primary-color: #0052cc;
            --background-color: #f0f2f5;
            --card-background-color: #ffffff;
            --text-color: #333;
            --text-secondary-color: #666;
            --border-color: #e8e8e8;
            --status-success: #1e8e3e;
            --status-warning: #ff8f00;
            --status-danger: #d93025;
            --status-info: #0052cc;
            --status-neutral: #e0e0e0;
        }

        body {
            font-family: "Helvetica Neue", "Arial", "Roboto", "Microsoft YaHei", sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            font-size: 14px;
        }

        .dashboard-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--card-background-color);
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09);
        }

        .dashboard-header h1 {
            font-size: 22px;
            color: var(--primary-color);
            margin: 0;
        }
        
        .header-filters {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header-filters label {
            font-weight: bold;
            color: var(--text-secondary-color);
        }
        
        .header-filters select, .header-filters input {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            font-size: 14px;
        }

        .card {
            background-color: var(--card-background-color);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09);
            padding: 20px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0 0 20px 0;
            color: var(--text-color);
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
        }

        .kpi-card {
            text-align: center;
        }

        .kpi-card .kpi-value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0 5px 0;
        }
        
        .kpi-card .kpi-title {
            font-size: 14px;
            color: var(--text-secondary-color);
            margin: 0;
        }

        .chart-container-sm {
            width: 100%;
            height: 80px;
        }
        
        .heatmap-card {
            grid-column: span 12;
        }
        
        .heatmap-container {
            width: 100%;
            height: 400px;
        }
        
        .stats-table-card {
            grid-column: span 12;
        }
        
        .tab-controls {
            margin-bottom: 20px;
        }
        
        .tab-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background-color: #f9f9f9;
            cursor: pointer;
            border-radius: 4px;
            margin-right: 5px;
        }
        
        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .stats-table th, .stats-table td {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: center;
        }
        
        .stats-table th {
            background-color: #fafafa;
        }
        
        .stats-table .header-row-2 th {
            font-weight: normal;
        }
        
        .rate-cell {
            font-weight: bold;
        }
        
        .rate-good { background-color: #e6f4ea; color: #1e8e3e; }
        .rate-avg { background-color: #fff8e1; color: #ff8f00; }
        .rate-bad { background-color: #fce8e6; color: #d93025; }
        
        .sub-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            grid-column: span 12;
        }
        
        .chart-card {
            height: 350px;
        }
        
        .chart-container-md {
            width: 100%;
            height: 300px;
        }
        
        .risk-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        
        .risk-list li {
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .risk-list li:last-child {
            border-bottom: none;
        }
        
        .risk-list .risk-tag {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
            font-weight: bold;
        }
        
        .tag-archive { background-color: var(--status-warning); }
        .tag-completeness { background-color: var(--status-danger); }
        .tag-timeliness { background-color: var(--status-info); }

    </style>
</head>
<body>

    <div class="dashboard-container">
        <header class="dashboard-header">
            <h1>项目采购与成本管理系统 - 监控中心</h1>
            <div class="header-filters">
                <label for="year-select">统计年份:</label>
                <select id="year-select">
                    <option>2025</option>
                    <option>2024</option>
                    <option>2023</option>
                </select>
                <label for="start-date-picker">监控起始日期:</label>
                <input type="date" id="start-date-picker" value="2025-01-01">
            </div>
        </header>

        <!-- 模块一：核心KPIs -->
        <div class="grid-container">
            <div class="card kpi-card">
                <div id="timeliness-rate-chart" class="chart-container-sm"></div>
                <p class="kpi-title">总体更新准时率</p>
            </div>
            <div class="card kpi-card">
                <p class="kpi-value" style="color: var(--status-danger);">89</p>
                <p class="kpi-title">累计延迟事件数</p>
            </div>
            <div class="card kpi-card">
                <div id="archive-rate-chart" class="chart-container-sm"></div>
                <p class="kpi-title">总体归档率</p>
            </div>
            <div class="card kpi-card">
                <p class="kpi-value" style="color: var(--status-warning);">23</p>
                <p class="kpi-title">逾期归档总数</p>
            </div>
            <div class="card kpi-card">
                <div id="completeness-rate-chart" class="chart-container-sm"></div>
                <p class="kpi-title">数据齐全率</p>
            </div>
            <div class="card kpi-card">
                <p class="kpi-value" style="color: var(--status-info);">¥1.25 亿</p>
                <p class="kpi-title">待结算合同总额</p>
            </div>
        </div>

        <div class="main-grid">
            <!-- 模块二：数据更新时效性监控 -->
            <div class="card heatmap-card">
                <h2 class="card-title">数据更新时效性监控 (按项目)</h2>
                <div id="heatmap-chart" class="heatmap-container"></div>
            </div>

            <!-- 模块三：详细统计数据表 -->
            <div class="card stats-table-card">
                <div class="card-title-container" style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 class="card-title" style="margin-bottom: 0;">详细统计数据</h2>
                    <div class="tab-controls">
                        <button class="tab-btn active">按项目统计</button>
                        <button class="tab-btn">按人员统计</button>
                    </div>
                </div>
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th rowspan="2">项目名称</th>
                            <th colspan="4">采购</th>
                            <th colspan="4">合同</th>
                            <th colspan="4">付款</th>
                            <th colspan="4">结算</th>
                            <th colspan="4">总计</th>
                        </tr>
                        <tr class="header-row-2">
                            <th>准时</th><th>延迟</th><th>总数</th><th>准时率</th>
                            <th>准时</th><th>延迟</th><th>总数</th><th>准时率</th>
                            <th>准时</th><th>延迟</th><th>总数</th><th>准时率</th>
                            <th>准时</th><th>延迟</th><th>总数</th><th>准时率</th>
                            <th>准时</th><th>延迟</th><th>总数</th><th>准时率</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>智慧城市一期</td>
                            <td>10</td><td>2</td><td>12</td><td class="rate-cell rate-avg">83.3%</td>
                            <td>8</td><td>0</td><td>8</td><td class="rate-cell rate-good">100%</td>
                            <td>25</td><td>5</td><td>30</td><td class="rate-cell rate-avg">83.3%</td>
                            <td>3</td><td>3</td><td>6</td><td class="rate-cell rate-bad">50.0%</td>
                            <td>46</td><td>10</td><td>56</td><td class="rate-cell rate-avg">82.1%</td>
                        </tr>
                        <tr>
                            <td>数据中心扩容</td>
                            <td>5</td><td>0</td><td>5</td><td class="rate-cell rate-good">100%</td>
                            <td>12</td><td>1</td><td>13</td><td class="rate-cell rate-good">92.3%</td>
                            <td>18</td><td>2</td><td>20</td><td class="rate-cell rate-good">90.0%</td>
                            <td>4</td><td>0</td><td>4</td><td class="rate-cell rate-good">100%</td>
                            <td>39</td><td>3</td><td>42</td><td class="rate-cell rate-good">92.9%</td>
                        </tr>
                        <tr>
                            <td>研发中心建设</td>
                            <td>8</td><td>8</td><td>16</td><td class="rate-cell rate-bad">50.0%</td>
                            <td>15</td><td>10</td><td>25</td><td class="rate-cell rate-bad">60.0%</td>
                            <td>40</td><td>25</td><td>65</td><td class="rate-cell rate-bad">61.5%</td>
                            <td>5</td><td>5</td><td>10</td><td class="rate-cell rate-bad">50.0%</td>
                            <td>68</td><td>48</td><td>116</td><td class="rate-cell rate-bad">58.6%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="sub-grid">
                <!-- 模块四：业务核心统计 -->
                <div class="card chart-card">
                    <h2 class="card-title">采购方式统计 (按金额)</h2>
                    <div id="procurement-chart" class="chart-container-md"></div>
                </div>
                <div class="card chart-card">
                    <h2 class="card-title">合同类型统计 (按数量)</h2>
                    <div id="contract-chart" class="chart-container-md"></div>
                </div>
                <!-- 模块五：风险与待办 -->
                <div class="card">
                    <h2 class="card-title">风险与待办 Top 5</h2>
                    <ul class="risk-list">
                        <li><span>研发中心建设 - 结算模块数据延迟严重</span><span class="risk-tag tag-timeliness">时效性</span></li>
                        <li><span>补充协议 (HT-2025-SUP003) 缺少主合同关联</span><span class="risk-tag tag-completeness">齐全性</span></li>
                        <li><span>智慧城市一期 - 采购归档逾期 (已逾期15天)</span><span class="risk-tag tag-archive">归档</span></li>
                        <li><span>采购合同 (HT-2025-CG015) 缺少采购项目关联</span><span class="risk-tag tag-completeness">齐全性</span></li>
                        <li><span>数据中心扩容 - 合同归档逾期 (已逾期8天)</span><span class="risk-tag tag-archive">归档</span></li>
                    </ul>
                </div>
                <div class="card">
                    <h2 class="card-title">报表中心</h2>
                    <p>快速生成或访问标准化的业务报表。</p>
                    <button class="tab-btn active">生成周报</button>
                    <button class="tab-btn">生成月报</button>
                    <button class="tab-btn">查看所有报表</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // 初始化所有图表
            initKpiCharts();
            initHeatmapChart();
            initBusinessCharts();
        });

        function initKpiCharts() {
            const timelinessChart = echarts.init(document.getElementById('timeliness-rate-chart'));
            const archiveChart = echarts.init(document.getElementById('archive-rate-chart'));
            const completenessChart = echarts.init(document.getElementById('completeness-rate-chart'));

            const createGaugeOption = (value, color) => ({
                series: [{
                    type: 'gauge',
                    startAngle: 90, endAngle: -270,
                    pointer: { show: false },
                    progress: { show: true, overlap: false, width: 10, roundCap: true, clip: false, itemStyle: { color: color } },
                    axisLine: { lineStyle: { width: 10, color: [[1, '#E6EBF8']] } },
                    splitLine: { show: false }, axisTick: { show: false }, axisLabel: { show: false },
                    data: [{ value: value }],
                    detail: { fontSize: 20, fontWeight: 'bold', color: 'auto', formatter: '{value}%' }
                }]
            });

            timelinessChart.setOption(createGaugeOption(85.6, '#0052cc'));
            archiveChart.setOption(createGaugeOption(92.1, '#1e8e3e'));
            completenessChart.setOption(createGaugeOption(98.5, '#1e8e3e'));
        }

        function initHeatmapChart() {
            const chart = echarts.init(document.getElementById('heatmap-chart'));
            const projects = ['智慧城市一期', '数据中心扩容', '研发中心建设', '总部大楼智能化', '物流网络优化'];
            const months = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];
            
            let data = [];
            for (let i = 0; i < projects.length; i++) {
                for (let j = 0; j < months.length; j++) {
                    let rate = Math.random() * 50 + 50; // 50-100
                    if (Math.random() < 0.1) rate = Math.random() * 40; // < 40
                    if (Math.random() < 0.1) rate = -1; // No data
                    data.push([j, i, Math.round(rate * 10) / 10]);
                }
            }
            
            const option = {
                tooltip: {
                    position: 'top',
                    formatter: params => {
                        if (params.value[2] < 0) return '无业务数据';
                        return `${projects[params.value[1]]}<br/>${months[params.value[0]]}: ${params.value[2]}%`;
                    }
                },
                grid: { height: '70%', top: '10%', bottom: '10%' },
                xAxis: { type: 'category', data: months, splitArea: { show: true } },
                yAxis: { type: 'category', data: projects, splitArea: { show: true } },
                visualMap: {
                    min: 0, max: 100,
                    calculable: true,
                    orient: 'horizontal',
                    left: 'center',
                    bottom: '0%',
                    pieces: [
                        { gte: 90, color: '#1e8e3e' },
                        { gte: 60, lt: 90, color: '#ff8f00' },
                        { lt: 60, color: '#d93025' },
                        { value: -1, color: '#f0f2f5', label: '无业务' }
                    ],
                },
                series: [{
                    name: '更新准时率',
                    type: 'heatmap',
                    data: data,
                    label: { show: false },
                    emphasis: { itemStyle: { shadowBlur: 10, shadowColor: 'rgba(0, 0, 0, 0.5)' } }
                }]
            };
            chart.setOption(option);
        }
        
        function initBusinessCharts() {
            const procurementChart = echarts.init(document.getElementById('procurement-chart'));
            const contractChart = echarts.init(document.getElementById('contract-chart'));
            
            const procurementOption = {
                tooltip: { trigger: 'item', formatter: '{b}: {c}元 ({d}%)' },
                legend: { orient: 'vertical', left: 'left' },
                series: [{
                    type: 'pie',
                    radius: '50%',
                    data: [
                        { value: 10480000, name: '公开招标' },
                        { value: 7350000, name: '邀请招标' },
                        { value: 5800000, name: '竞争性谈判' },
                        { value: 4840000, name: '单一来源' },
                        { value: 3000000, name: '询价' }
                    ],
                    emphasis: { itemStyle: { shadowBlur: 10, shadowColor: 'rgba(0, 0, 0, 0.5)' } }
                }]
            };
            
            const contractOption = {
                tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
                xAxis: { type: 'category', data: ['主合同', '补充协议', '框架协议'] },
                yAxis: { type: 'value' },
                series: [{
                    data: [120, 58, 32],
                    type: 'bar',
                    itemStyle: { color: '#0052cc' }
                }]
            };
            
            procurementChart.setOption(procurementOption);
            contractChart.setOption(contractOption);
        }

        window.addEventListener('resize', function() {
            // Resize all charts
            ['timeliness-rate-chart', 'archive-rate-chart', 'completeness-rate-chart', 'heatmap-chart', 'procurement-chart', 'contract-chart'].forEach(id => {
                const chartInstance = echarts.getInstanceByDom(document.getElementById(id));
                if (chartInstance) {
                    chartInstance.resize();
                }
            });
        });
    </script>

</body>
</html>